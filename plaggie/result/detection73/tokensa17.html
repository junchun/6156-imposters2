<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(47):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token2">2:</A>4(49)-4(75):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token3">3:</A>5(77)-5(99):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token4">4:</A>6(101)-6(124):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token5">5:</A>7(126)-7(147):IMPORT_DECLARATION:import models.Message;
<A NAME="token6">6:</A>8(149)-8(167):IMPORT_DECLARATION:import models.Move;
<A NAME="token7">7:</A>9(169)-9(189):IMPORT_DECLARATION:import models.Player;
<A NAME="token8">8:</A>10(191)-10(237):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token9">9:</A>10(237)-12(255):CLASS_DECLARATION:;
<A NAME="token10">10:</A>14(285)-14(302):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token11">11:</A>16(331)-16(333):VARIABLE_DECLARATION:app
<A NAME="token12">12:</A>21(442)-21(468):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token13">13:</A>26(501)-26(517):IF:if (app=="/echo")
<A NAME="token14">14:</A>26(518)-26(518):BLOCK:{
<A NAME="token15">15:</A>27(526)-27(547):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token16">16:</A>27(537)-27(546):METHOD_INVOCATION:ctx.body()
<A NAME="token17">17:</A>28(554)-28(554):BLOCK_END:}
<A NAME="token18">18:</A>28(554)-28(554):IF_END:}
<A NAME="token19">19:</A>30(575)-30(601):VARIABLE_DECLARATION:gameboard = new GameBoard()
<A NAME="token20">20:</A>30(587)-30(601):NEW:new GameBoard()
<A NAME="token21">21:</A>32(610)-32(629):IF:if (app=="/newgame")
<A NAME="token22">22:</A>32(630)-32(630):BLOCK:{
<A NAME="token23">23:</A>33(638)-33(667):METHOD_INVOCATION:ctx.redirect("tictactoe.html")
<A NAME="token24">24:</A>34(674)-34(674):BLOCK_END:}
<A NAME="token25">25:</A>34(674)-34(674):IF_END:}
<A NAME="token26">26:</A>36(681)-36(702):IF:if (app=="/startgame")
<A NAME="token27">27:</A>36(703)-36(703):BLOCK:{
<A NAME="token28">28:</A>38(712)-38(737):METHOD_INVOCATION:gameboard.resetGameBoard()
<A NAME="token29">29:</A>39(746)-39(808):METHOD_INVOCATION:gameboard.setP1(new Player(1, ctx.formParam("type").charAt(0)))
<A NAME="token30">30:</A>39(762)-39(807):NEW:new Player(1, ctx.formParam("type").charAt(0))
<A NAME="token31">31:</A>39(776)-39(796):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token32">32:</A>39(776)-39(806):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token33">33:</A>41(819)-41(848):METHOD_INVOCATION:ctx.result(gameboard.toJson())
<A NAME="token34">34:</A>41(830)-41(847):METHOD_INVOCATION:gameboard.toJson()
<A NAME="token35">35:</A>42(855)-42(855):BLOCK_END:}
<A NAME="token36">36:</A>42(855)-42(855):IF_END:}
<A NAME="token37">37:</A>44(862)-44(882):IF:if (app=="/joingame")
<A NAME="token38">38:</A>44(883)-44(883):BLOCK:{
<A NAME="token39">39:</A>46(892)-46(921):IF:if (gameboard.getP1() == null)
<A NAME="token40">40:</A>46(896)-46(912):METHOD_INVOCATION:gameboard.getP1()
<A NAME="token41">41:</A>46(923)-46(923):BLOCK:{
<A NAME="token42">42:</A>47(933)-47(1010):METHOD_INVOCATION:ctx.html("&lt;h1 style=\"color:red;\"&gt;Player 1 has not started a game yet.&lt;/h1&gt;")
<A NAME="token43">43:</A>48(1021)-48(1027):RETURN:return;
<A NAME="token44">44:</A>49(1035)-49(1035):BLOCK_END:}
<A NAME="token45">45:</A>49(1035)-49(1035):IF_END:}
<A NAME="token46">46:</A>51(1044)-51(1110):METHOD_INVOCATION:gameboard.setP2(new Player(2, gameboard.getP1().getOpposingType()))
<A NAME="token47">47:</A>51(1060)-51(1109):NEW:new Player(2, gameboard.getP1().getOpposingType())
<A NAME="token48">48:</A>51(1074)-51(1090):METHOD_INVOCATION:gameboard.getP1()
<A NAME="token49">49:</A>51(1074)-51(1108):METHOD_INVOCATION:gameboard.getP1().getOpposingType()
<A NAME="token50">50:</A>52(1119)-52(1148):METHOD_INVOCATION:gameboard.setGameStarted(true)
<A NAME="token51">51:</A>54(1158)-54(1202):METHOD_INVOCATION:sendGameBoardToAllPlayers(gameboard.toJson())
<A NAME="token52">52:</A>54(1184)-54(1201):METHOD_INVOCATION:gameboard.toJson()
<A NAME="token53">53:</A>56(1212)-56(1246):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token54">54:</A>57(1253)-57(1253):BLOCK_END:}
<A NAME="token55">55:</A>57(1253)-57(1253):IF_END:}
<A NAME="token56">56:</A>59(1263)-59(1289):IF:if (app=="/move/:playerId")
<A NAME="token57">57:</A>59(1290)-59(1290):BLOCK:{
<A NAME="token58">58:</A>61(1307)-61(1313):VARIABLE_DECLARATION:message
<A NAME="token59">59:</A>63(1323)-65(1442):IF:if (ctx.pathParam("playerId") == null 
<A NAME="token60">60:</A>63(1327)-63(1351):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token61">61:</A>64(1375)-64(1392):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token62">62:</A>65(1416)-65(1433):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token63">63:</A>65(1444)-65(1444):BLOCK:{
<A NAME="token64">64:</A>67(1455)-67(1477):ASSIGNMENT:message = new Message()
<A NAME="token65">65:</A>67(1465)-67(1477):NEW:new Message()
<A NAME="token66">66:</A>68(1488)-68(1517):METHOD_INVOCATION:message.setMoveValidity(false)
<A NAME="token67">67:</A>69(1528)-69(1588):METHOD_INVOCATION:message.setMessage("Invalid or missing parameters supplied.")
<A NAME="token68">68:</A>70(1597)-70(1597):BLOCK_END:}
<A NAME="token69">69:</A>70(1597)-70(1597):IF_END:}
<A NAME="token70">70:</A>70(1599)-70(1602):ELSE:else
<A NAME="token71">71:</A>70(1604)-70(1604):BLOCK:{
<A NAME="token72">72:</A>72(1619)-72(1672):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token73">73:</A>72(1630)-72(1672):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token74">74:</A>72(1647)-72(1671):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token75">75:</A>73(1687)-73(1730):VARIABLE_DECLARATION:moveX = Integer.parseInt(ctx.formParam("x"))
<A NAME="token76">76:</A>73(1695)-73(1730):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token77">77:</A>73(1712)-73(1729):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token78">78:</A>74(1745)-74(1788):VARIABLE_DECLARATION:moveY = Integer.parseInt(ctx.formParam("y"))
<A NAME="token79">79:</A>74(1753)-74(1788):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token80">80:</A>74(1770)-74(1787):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token81">81:</A>76(1807)-76(1868):VARIABLE_DECLARATION:player = playerId == 1 ? gameboard.getP1() : gameboard.getP2()
<A NAME="token82">82:</A>76(1832)-76(1848):METHOD_INVOCATION:gameboard.getP1()
<A NAME="token83">83:</A>76(1852)-76(1868):METHOD_INVOCATION:gameboard.getP2()
<A NAME="token84">84:</A>77(1884)-77(1920):VARIABLE_DECLARATION:move = new Move(player, moveX, moveY)
<A NAME="token85">85:</A>77(1891)-77(1920):NEW:new Move(player, moveX, moveY)
<A NAME="token86">86:</A>79(1932)-79(1964):ASSIGNMENT:message = gameboard.addMove(move)
<A NAME="token87">87:</A>79(1942)-79(1964):METHOD_INVOCATION:gameboard.addMove(move)
<A NAME="token88">88:</A>80(1973)-80(1973):BLOCK_END:}
<A NAME="token89">89:</A>80(1973)-80(1973):ELSE_END:}
<A NAME="token90">90:</A>82(1982)-82(2009):METHOD_INVOCATION:ctx.result(message.toJson())
<A NAME="token91">91:</A>82(1993)-82(2008):METHOD_INVOCATION:message.toJson()
<A NAME="token92">92:</A>84(2019)-84(2048):IF:if (message.getMoveValidity())
<A NAME="token93">93:</A>84(2023)-84(2047):METHOD_INVOCATION:message.getMoveValidity()
<A NAME="token94">94:</A>84(2050)-84(2050):BLOCK:{
<A NAME="token95">95:</A>85(2060)-85(2104):METHOD_INVOCATION:sendGameBoardToAllPlayers(gameboard.toJson())
<A NAME="token96">96:</A>85(2086)-85(2103):METHOD_INVOCATION:gameboard.toJson()
<A NAME="token97">97:</A>86(2113)-86(2113):BLOCK_END:}
<A NAME="token98">98:</A>86(2113)-86(2113):IF_END:}
<A NAME="token99">99:</A>87(2119)-87(2119):BLOCK_END:}
<A NAME="token100">100:</A>87(2119)-87(2119):IF_END:}
<A NAME="token101">101:</A>90(2171)-90(2209):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token102">102:</A>90(2192)-90(2208):NEW:new UiWebSocket()
<A NAME="token103">103:</A>91(2214)-91(2214):METHOD_DECLARATION_END:}
<A NAME="token104">104:</A>97(2382)-97(2436):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token105">105:</A>98(2457)-98(2492):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token106">106:</A>98(2468)-98(2492):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token107">107:</A>99(2499)-99(2536):FOR:for (Session sessionPlayer : sessions)
<A NAME="token108">108:</A>99(2538)-99(2538):BLOCK:{
<A NAME="token109">109:</A>100(2546)-100(2550):TRY:try {
<A NAME="token110">110:</A>101(2560)-101(2584):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token111">111:</A>101(2560)-101(2610):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token112">112:</A>102(2619)-102(2619):TRY_END:}
<A NAME="token113">113:</A>102(2621)-102(2643):CATCH:catch (IOException e) {
<A NAME="token114">114:</A>104(2678)-104(2678):CATCH_END:}
<A NAME="token115">115:</A>105(2684)-105(2684):BLOCK_END:}
<A NAME="token116">116:</A>105(2684)-105(2684):FOR_END:}
<A NAME="token117">117:</A>106(2688)-106(2688):METHOD_DECLARATION_END:}
<A NAME="token118">118:</A>108(2712)-108(2719):METHOD_DECLARATION:stop() {
<A NAME="token119">119:</A>109(2725)-109(2734):METHOD_INVOCATION:app.stop()
<A NAME="token120">120:</A>110(2739)-110(2739):METHOD_DECLARATION_END:}
<A NAME="token121">121:</A>111(2741)-111(2741):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
