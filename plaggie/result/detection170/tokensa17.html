<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(47):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token2">2:</A>4(49)-4(75):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token3">3:</A>5(77)-5(99):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token4">4:</A>6(101)-6(124):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token5">5:</A>7(126)-7(147):IMPORT_DECLARATION:import models.Message;
<A NAME="token6">6:</A>8(149)-8(167):IMPORT_DECLARATION:import models.Move;
<A NAME="token7">7:</A>9(169)-9(189):IMPORT_DECLARATION:import models.Player;
<A NAME="token8">8:</A>10(191)-10(237):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token9">9:</A>10(237)-12(255):CLASS_DECLARATION:;
<A NAME="token10">10:</A>14(285)-14(302):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token11">11:</A>15(330)-15(332):VARIABLE_DECLARATION:app
<A NAME="token12">12:</A>16(362)-16(365):VARIABLE_DECLARATION:game
<A NAME="token13">13:</A>21(476)-21(502):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token14">14:</A>27(552)-27(568):IF:if (app=="/echo")
<A NAME="token15">15:</A>27(570)-27(570):BLOCK:{
<A NAME="token16">16:</A>28(578)-28(599):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token17">17:</A>28(589)-28(598):METHOD_INVOCATION:ctx.body()
<A NAME="token18">18:</A>29(606)-29(606):BLOCK_END:}
<A NAME="token19">19:</A>29(606)-29(606):IF_END:}
<A NAME="token20">20:</A>32(651)-32(670):IF:if (app=="/newgame")
<A NAME="token21">21:</A>32(672)-32(672):BLOCK:{
<A NAME="token22">22:</A>33(680)-33(710):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token23">23:</A>34(717)-34(717):BLOCK_END:}
<A NAME="token24">24:</A>34(717)-34(717):IF_END:}
<A NAME="token25">25:</A>37(781)-37(802):IF:if (app=="/startgame")
<A NAME="token26">26:</A>37(804)-37(804):BLOCK:{
<A NAME="token27">27:</A>38(817)-38(862):VARIABLE_DECLARATION:type1 = ctx.req.getParameter("type").charAt(0)
<A NAME="token28">28:</A>38(825)-38(852):METHOD_INVOCATION:ctx.req.getParameter("type")
<A NAME="token29">29:</A>38(825)-38(862):METHOD_INVOCATION:ctx.req.getParameter("type").charAt(0)
<A NAME="token30">30:</A>39(878)-39(902):VARIABLE_DECLARATION:p1 = new Player(type1, 1)
<A NAME="token31">31:</A>39(883)-39(902):NEW:new Player(type1, 1)
<A NAME="token32">32:</A>40(911)-40(934):ASSIGNMENT:game = new GameBoard(p1)
<A NAME="token33">33:</A>40(918)-40(934):NEW:new GameBoard(p1)
<A NAME="token34">34:</A>41(943)-41(969):METHOD_INVOCATION:ctx.result(game.getBoard())
<A NAME="token35">35:</A>41(954)-41(968):METHOD_INVOCATION:game.getBoard()
<A NAME="token36">36:</A>42(976)-42(976):BLOCK_END:}
<A NAME="token37">37:</A>42(976)-42(976):IF_END:}
<A NAME="token38">38:</A>45(1027)-45(1047):IF:if (app=="/joingame")
<A NAME="token39">39:</A>45(1049)-45(1049):BLOCK:{
<A NAME="token40">40:</A>46(1062)-46(1066):VARIABLE_DECLARATION:type2
<A NAME="token41">41:</A>47(1075)-47(1102):IF:if (game.getP1Type() == 'X')
<A NAME="token42">42:</A>47(1079)-47(1094):METHOD_INVOCATION:game.getP1Type()
<A NAME="token43">43:</A>47(1104)-47(1104):BLOCK:{
<A NAME="token44">44:</A>48(1114)-48(1124):ASSIGNMENT:type2 = 'O'
<A NAME="token45">45:</A>49(1133)-49(1133):BLOCK_END:}
<A NAME="token46">46:</A>49(1133)-49(1133):IF_END:}
<A NAME="token47">47:</A>49(1135)-49(1138):ELSE:else
<A NAME="token48">48:</A>49(1140)-49(1140):BLOCK:{
<A NAME="token49">49:</A>50(1150)-50(1160):ASSIGNMENT:type2 = 'X'
<A NAME="token50">50:</A>51(1169)-51(1169):BLOCK_END:}
<A NAME="token51">51:</A>51(1169)-51(1169):ELSE_END:}
<A NAME="token52">52:</A>52(1184)-52(1208):VARIABLE_DECLARATION:p2 = new Player(type2, 2)
<A NAME="token53">53:</A>52(1189)-52(1208):NEW:new Player(type2, 2)
<A NAME="token54">54:</A>53(1217)-53(1230):METHOD_INVOCATION:game.addP2(p2)
<A NAME="token55">55:</A>54(1239)-54(1273):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token56">56:</A>55(1282)-55(1297):METHOD_INVOCATION:game.startGame()
<A NAME="token57">57:</A>56(1306)-56(1347):METHOD_INVOCATION:sendGameBoardToAllPlayers(game.getBoard())
<A NAME="token58">58:</A>56(1332)-56(1346):METHOD_INVOCATION:game.getBoard()
<A NAME="token59">59:</A>57(1354)-57(1354):BLOCK_END:}
<A NAME="token60">60:</A>57(1354)-57(1354):IF_END:}
<A NAME="token61">61:</A>61(1393)-61(1411):IF:if (app=="/move/1")
<A NAME="token62">62:</A>61(1413)-61(1413):BLOCK:{
<A NAME="token63">63:</A>62(1425)-62(1471):VARIABLE_DECLARATION:x = Integer.parseInt(ctx.req.getParameter("x"))
<A NAME="token64">64:</A>62(1429)-62(1471):METHOD_INVOCATION:Integer.parseInt(ctx.req.getParameter("x"))
<A NAME="token65">65:</A>62(1446)-62(1470):METHOD_INVOCATION:ctx.req.getParameter("x")
<A NAME="token66">66:</A>63(1484)-63(1530):VARIABLE_DECLARATION:y = Integer.parseInt(ctx.req.getParameter("y"))
<A NAME="token67">67:</A>63(1488)-63(1530):METHOD_INVOCATION:Integer.parseInt(ctx.req.getParameter("y"))
<A NAME="token68">68:</A>63(1505)-63(1529):METHOD_INVOCATION:ctx.req.getParameter("y")
<A NAME="token69">69:</A>64(1544)-64(1578):VARIABLE_DECLARATION:move = new Move(game.getP1(), x, y)
<A NAME="token70">70:</A>64(1551)-64(1578):NEW:new Move(game.getP1(), x, y)
<A NAME="token71">71:</A>64(1560)-64(1571):METHOD_INVOCATION:game.getP1()
<A NAME="token72">72:</A>65(1595)-65(1619):VARIABLE_DECLARATION:message = game.move(move)
<A NAME="token73">73:</A>65(1605)-65(1619):METHOD_INVOCATION:game.move(move)
<A NAME="token74">74:</A>66(1628)-66(1659):METHOD_INVOCATION:ctx.result(message.getMessage())
<A NAME="token75">75:</A>66(1639)-66(1658):METHOD_INVOCATION:message.getMessage()
<A NAME="token76">76:</A>67(1668)-67(1709):METHOD_INVOCATION:sendGameBoardToAllPlayers(game.getBoard())
<A NAME="token77">77:</A>67(1694)-67(1708):METHOD_INVOCATION:game.getBoard()
<A NAME="token78">78:</A>68(1718)-68(1764):METHOD_INVOCATION:System.out.println("Sent board to all players")
<A NAME="token79">79:</A>69(1771)-69(1771):BLOCK_END:}
<A NAME="token80">80:</A>69(1771)-69(1771):IF_END:}
<A NAME="token81">81:</A>72(1805)-72(1823):IF:if (app=="/move/2")
<A NAME="token82">82:</A>72(1825)-72(1825):BLOCK:{
<A NAME="token83">83:</A>73(1837)-73(1883):VARIABLE_DECLARATION:x = Integer.parseInt(ctx.req.getParameter("x"))
<A NAME="token84">84:</A>73(1841)-73(1883):METHOD_INVOCATION:Integer.parseInt(ctx.req.getParameter("x"))
<A NAME="token85">85:</A>73(1858)-73(1882):METHOD_INVOCATION:ctx.req.getParameter("x")
<A NAME="token86">86:</A>74(1896)-74(1942):VARIABLE_DECLARATION:y = Integer.parseInt(ctx.req.getParameter("y"))
<A NAME="token87">87:</A>74(1900)-74(1942):METHOD_INVOCATION:Integer.parseInt(ctx.req.getParameter("y"))
<A NAME="token88">88:</A>74(1917)-74(1941):METHOD_INVOCATION:ctx.req.getParameter("y")
<A NAME="token89">89:</A>75(1956)-75(1990):VARIABLE_DECLARATION:move = new Move(game.getP2(), x, y)
<A NAME="token90">90:</A>75(1963)-75(1990):NEW:new Move(game.getP2(), x, y)
<A NAME="token91">91:</A>75(1972)-75(1983):METHOD_INVOCATION:game.getP2()
<A NAME="token92">92:</A>76(2007)-76(2031):VARIABLE_DECLARATION:message = game.move(move)
<A NAME="token93">93:</A>76(2017)-76(2031):METHOD_INVOCATION:game.move(move)
<A NAME="token94">94:</A>77(2040)-77(2071):METHOD_INVOCATION:ctx.result(message.getMessage())
<A NAME="token95">95:</A>77(2051)-77(2070):METHOD_INVOCATION:message.getMessage()
<A NAME="token96">96:</A>78(2080)-78(2121):METHOD_INVOCATION:sendGameBoardToAllPlayers(game.getBoard())
<A NAME="token97">97:</A>78(2106)-78(2120):METHOD_INVOCATION:game.getBoard()
<A NAME="token98">98:</A>79(2130)-79(2176):METHOD_INVOCATION:System.out.println("Sent board to all players")
<A NAME="token99">99:</A>80(2183)-80(2183):BLOCK_END:}
<A NAME="token100">100:</A>80(2183)-80(2183):IF_END:}
<A NAME="token101">101:</A>83(2235)-83(2273):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token102">102:</A>83(2256)-83(2272):NEW:new UiWebSocket()
<A NAME="token103">103:</A>84(2278)-84(2278):METHOD_DECLARATION_END:}
<A NAME="token104">104:</A>92(2459)-92(2513):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token105">105:</A>93(2534)-93(2569):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token106">106:</A>93(2545)-93(2569):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token107">107:</A>94(2576)-94(2613):FOR:for (Session sessionPlayer : sessions)
<A NAME="token108">108:</A>94(2615)-94(2615):BLOCK:{
<A NAME="token109">109:</A>95(2623)-95(2627):TRY:try {
<A NAME="token110">110:</A>96(2637)-96(2661):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token111">111:</A>96(2637)-96(2687):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token112">112:</A>97(2696)-97(2696):TRY_END:}
<A NAME="token113">113:</A>97(2698)-97(2720):CATCH:catch (IOException e) {
<A NAME="token114">114:</A>98(2730)-98(2792):METHOD_INVOCATION:System.out.println("Failed to send game board to all players.")
<A NAME="token115">115:</A>99(2801)-99(2801):CATCH_END:}
<A NAME="token116">116:</A>100(2807)-100(2807):BLOCK_END:}
<A NAME="token117">117:</A>100(2807)-100(2807):FOR_END:}
<A NAME="token118">118:</A>101(2811)-101(2811):METHOD_DECLARATION_END:}
<A NAME="token119">119:</A>103(2835)-103(2842):METHOD_DECLARATION:stop() {
<A NAME="token120">120:</A>104(2848)-104(2857):METHOD_INVOCATION:app.stop()
<A NAME="token121">121:</A>105(2862)-105(2862):METHOD_DECLARATION_END:}
<A NAME="token122">122:</A>106(2864)-106(2864):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
