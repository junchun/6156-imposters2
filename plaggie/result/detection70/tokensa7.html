<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(47):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token2">2:</A>4(49)-4(75):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token3">3:</A>5(77)-5(99):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token4">4:</A>6(101)-6(147):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token5">5:</A>7(149)-7(169):IMPORT_DECLARATION:import models.Player;
<A NAME="token6">6:</A>8(171)-8(194):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token7">7:</A>9(196)-9(214):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(216)-10(237):IMPORT_DECLARATION:import models.Message;
<A NAME="token9">9:</A>11(239)-11(266):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token10">10:</A>13(269)-13(290):CLASS_DECLARATION:final class PlayGame {
<A NAME="token11">11:</A>18(374)-18(393):CONSTRUCTOR_DECLARATION:private PlayGame() {
<A NAME="token12">12:</A>20(450)-20(506):THROW:throw new AssertionError("Instantiating utility class.");
<A NAME="token13">13:</A>20(456)-20(505):NEW:new AssertionError("Instantiating utility class.")
<A NAME="token14">14:</A>21(510)-21(510):CONSTRUCTOR_DECLARATION_END:}
<A NAME="token15">15:</A>26(578)-26(595):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token16">16:</A>31(666)-31(668):VARIABLE_DECLARATION:app
<A NAME="token17">17:</A>36(777)-36(803):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token18">18:</A>37(819)-37(841):VARIABLE_DECLARATION:board = new GameBoard()
<A NAME="token19">19:</A>37(827)-37(841):NEW:new GameBoard()
<A NAME="token20">20:</A>41(874)-41(889):IF:if(app=="/echo")
<A NAME="token21">21:</A>41(890)-41(890):BLOCK:{
<A NAME="token22">22:</A>42(898)-42(919):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token23">23:</A>42(909)-42(918):METHOD_INVOCATION:ctx.body()
<A NAME="token24">24:</A>43(926)-43(926):BLOCK_END:}
<A NAME="token25">25:</A>43(926)-43(926):IF_END:}
<A NAME="token26">26:</A>45(933)-45(951):IF:if(app=="/newgame")
<A NAME="token27">27:</A>45(952)-45(952):BLOCK:{
<A NAME="token28">28:</A>46(960)-46(990):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token29">29:</A>47(997)-47(997):BLOCK_END:}
<A NAME="token30">30:</A>47(997)-47(997):IF_END:}
<A NAME="token31">31:</A>49(1004)-49(1024):IF:if(app=="/startgame")
<A NAME="token32">32:</A>49(1025)-49(1025):BLOCK:{
<A NAME="token33">33:</A>50(1033)-50(1053):METHOD_INVOCATION:board.setBoardState()
<A NAME="token34">34:</A>51(1062)-51(1077):METHOD_INVOCATION:board.setTurn(1)
<A NAME="token35">35:</A>52(1093)-52(1109):VARIABLE_DECLARATION:p1 = new Player()
<A NAME="token36">36:</A>52(1098)-52(1109):NEW:new Player()
<A NAME="token37">37:</A>53(1118)-53(1132):METHOD_INVOCATION:board.setP1(p1)
<A NAME="token38">38:</A>54(1141)-54(1183):METHOD_INVOCATION:p1.setType(ctx.formParam("type").charAt(0))
<A NAME="token39">39:</A>54(1152)-54(1172):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token40">40:</A>54(1152)-54(1182):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token41">41:</A>55(1192)-55(1202):METHOD_INVOCATION:p1.setId(1)
<A NAME="token42">42:</A>56(1211)-56(1246):METHOD_INVOCATION:ctx.result(new Gson().toJson(board))
<A NAME="token43">43:</A>56(1222)-56(1231):NEW:new Gson()
<A NAME="token44">44:</A>56(1222)-56(1245):METHOD_INVOCATION:new Gson().toJson(board)
<A NAME="token45">45:</A>57(1253)-57(1253):BLOCK_END:}
<A NAME="token46">46:</A>57(1253)-57(1253):IF_END:}
<A NAME="token47">47:</A>59(1260)-59(1279):IF:if(app=="/joingame")
<A NAME="token48">48:</A>59(1280)-59(1280):BLOCK:{
<A NAME="token49">49:</A>60(1295)-60(1311):VARIABLE_DECLARATION:p2 = new Player()
<A NAME="token50">50:</A>60(1300)-60(1311):NEW:new Player()
<A NAME="token51">51:</A>61(1320)-61(1334):METHOD_INVOCATION:board.setP2(p2)
<A NAME="token52">52:</A>62(1343)-62(1377):IF:if (board.getP1().getType() == 'X')
<A NAME="token53">53:</A>62(1347)-62(1359):METHOD_INVOCATION:board.getP1()
<A NAME="token54">54:</A>62(1347)-62(1369):METHOD_INVOCATION:board.getP1().getType()
<A NAME="token55">55:</A>62(1379)-62(1379):BLOCK:{
<A NAME="token56">56:</A>63(1389)-63(1403):METHOD_INVOCATION:p2.setType('O')
<A NAME="token57">57:</A>64(1412)-64(1412):BLOCK_END:}
<A NAME="token58">58:</A>64(1412)-64(1412):IF_END:}
<A NAME="token59">59:</A>64(1414)-64(1417):ELSE:else
<A NAME="token60">60:</A>64(1419)-64(1419):BLOCK:{
<A NAME="token61">61:</A>65(1429)-65(1443):METHOD_INVOCATION:p2.setType('X')
<A NAME="token62">62:</A>66(1452)-66(1452):BLOCK_END:}
<A NAME="token63">63:</A>66(1452)-66(1452):ELSE_END:}
<A NAME="token64">64:</A>67(1460)-67(1470):METHOD_INVOCATION:p2.setId(2)
<A NAME="token65">65:</A>68(1479)-68(1513):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token66">66:</A>69(1522)-69(1547):METHOD_INVOCATION:board.setGameStarted(true)
<A NAME="token67">67:</A>70(1556)-70(1606):METHOD_INVOCATION:sendGameBoardToAllPlayers(new Gson().toJson(board))
<A NAME="token68">68:</A>70(1582)-70(1591):NEW:new Gson()
<A NAME="token69">69:</A>70(1582)-70(1605):METHOD_INVOCATION:new Gson().toJson(board)
<A NAME="token70">70:</A>71(1613)-71(1613):BLOCK_END:}
<A NAME="token71">71:</A>71(1613)-71(1613):IF_END:}
<A NAME="token72">72:</A>73(1620)-73(1645):IF:if(app=="/move/:playerId")
<A NAME="token73">73:</A>73(1646)-73(1646):BLOCK:{
<A NAME="token74">74:</A>74(1658)-74(1711):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token75">75:</A>74(1669)-74(1711):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token76">76:</A>74(1686)-74(1710):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token77">77:</A>75(1725)-75(1741):VARIABLE_DECLARATION:move = new Move()
<A NAME="token78">78:</A>75(1732)-75(1741):NEW:new Move()
<A NAME="token79">79:</A>76(1758)-76(1780):VARIABLE_DECLARATION:message = new Message()
<A NAME="token80">80:</A>76(1768)-76(1780):NEW:new Message()
<A NAME="token81">81:</A>77(1789)-77(1835):METHOD_INVOCATION:move.setPlayer(board.getPlayerFromId(playerId))
<A NAME="token82">82:</A>77(1804)-77(1834):METHOD_INVOCATION:board.getPlayerFromId(playerId)
<A NAME="token83">83:</A>78(1844)-78(1894):METHOD_INVOCATION:move.setMoveX(Integer.parseInt(ctx.formParam("x")))
<A NAME="token84">84:</A>78(1858)-78(1893):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token85">85:</A>78(1875)-78(1892):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token86">86:</A>79(1903)-79(1953):METHOD_INVOCATION:move.setMoveY(Integer.parseInt(ctx.formParam("y")))
<A NAME="token87">87:</A>79(1917)-79(1952):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token88">88:</A>79(1934)-79(1951):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token89">89:</A>80(1962)-80(1994):IF:if (board.isValid(move, message))
<A NAME="token90">90:</A>80(1966)-80(1993):METHOD_INVOCATION:board.isValid(move, message)
<A NAME="token91">91:</A>80(1996)-80(1996):BLOCK:{
<A NAME="token92">92:</A>81(2006)-81(2025):METHOD_INVOCATION:board.makeMove(move)
<A NAME="token93">93:</A>82(2036)-82(2059):IF:if (!board.isOver(move))
<A NAME="token94">94:</A>82(2041)-82(2058):METHOD_INVOCATION:board.isOver(move)
<A NAME="token95">95:</A>82(2061)-82(2061):BLOCK:{
<A NAME="token96">96:</A>83(2073)-83(2090):METHOD_INVOCATION:board.switchTurn()
<A NAME="token97">97:</A>84(2101)-84(2101):BLOCK_END:}
<A NAME="token98">98:</A>84(2101)-84(2101):IF_END:}
<A NAME="token99">99:</A>85(2109)-85(2109):BLOCK_END:}
<A NAME="token100">100:</A>85(2109)-85(2109):IF_END:}
<A NAME="token101">101:</A>86(2117)-86(2154):METHOD_INVOCATION:ctx.result(new Gson().toJson(message))
<A NAME="token102">102:</A>86(2128)-86(2137):NEW:new Gson()
<A NAME="token103">103:</A>86(2128)-86(2153):METHOD_INVOCATION:new Gson().toJson(message)
<A NAME="token104">104:</A>87(2163)-87(2213):METHOD_INVOCATION:sendGameBoardToAllPlayers(new Gson().toJson(board))
<A NAME="token105">105:</A>87(2189)-87(2198):NEW:new Gson()
<A NAME="token106">106:</A>87(2189)-87(2212):METHOD_INVOCATION:new Gson().toJson(board)
<A NAME="token107">107:</A>88(2220)-88(2220):BLOCK_END:}
<A NAME="token108">108:</A>88(2220)-88(2220):IF_END:}
<A NAME="token109">109:</A>91(2272)-91(2310):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token110">110:</A>91(2293)-91(2309):NEW:new UiWebSocket()
<A NAME="token111">111:</A>92(2315)-92(2315):METHOD_DECLARATION_END:}
<A NAME="token112">112:</A>98(2483)-98(2537):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token113">113:</A>99(2558)-99(2593):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token114">114:</A>99(2569)-99(2593):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token115">115:</A>100(2600)-100(2637):FOR:for (Session sessionPlayer : sessions)
<A NAME="token116">116:</A>100(2639)-100(2639):BLOCK:{
<A NAME="token117">117:</A>101(2647)-101(2651):TRY:try {
<A NAME="token118">118:</A>102(2661)-102(2685):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token119">119:</A>102(2661)-102(2711):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token120">120:</A>103(2720)-103(2720):TRY_END:}
<A NAME="token121">121:</A>103(2722)-103(2744):CATCH:catch (IOException e) {
<A NAME="token122">122:</A>105(2781)-105(2799):METHOD_INVOCATION:e.printStackTrace()
<A NAME="token123">123:</A>106(2808)-106(2808):CATCH_END:}
<A NAME="token124">124:</A>107(2814)-107(2814):BLOCK_END:}
<A NAME="token125">125:</A>107(2814)-107(2814):FOR_END:}
<A NAME="token126">126:</A>108(2818)-108(2818):METHOD_DECLARATION_END:}
<A NAME="token127">127:</A>113(2881)-113(2888):METHOD_DECLARATION:stop() {
<A NAME="token128">128:</A>114(2894)-114(2903):METHOD_INVOCATION:app.stop()
<A NAME="token129">129:</A>115(2908)-115(2908):METHOD_DECLARATION_END:}
<A NAME="token130">130:</A>116(2910)-116(2910):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
