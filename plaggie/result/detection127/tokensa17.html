<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(130):IMPORT_DECLARATION:import java.util.HashMap;
<A NAME="token5">5:</A>7(132)-7(154):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token6">6:</A>8(156)-8(177):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(179)-9(197):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(199)-10(219):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(221)-11(267):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>12(269)-12(292):IMPORT_DECLARATION:import org.slf4j.Logger;
<A NAME="token11">11:</A>13(294)-13(324):IMPORT_DECLARATION:import org.slf4j.LoggerFactory;
<A NAME="token12">12:</A>13(324)-15(342):CLASS_DECLARATION:;
<A NAME="token13">13:</A>17(372)-17(389):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token14">14:</A>19(418)-19(420):VARIABLE_DECLARATION:app
<A NAME="token15">15:</A>25(532)-25(558):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token16">16:</A>28(586)-28(624):VARIABLE_DECLARATION:boardController = new BoardController()
<A NAME="token17">17:</A>28(604)-28(624):NEW:new BoardController()
<A NAME="token18">18:</A>30(655)-30(671):IF:if (app=="/echo")
<A NAME="token19">19:</A>30(673)-30(673):BLOCK:{
<A NAME="token20">20:</A>31(681)-31(702):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token21">21:</A>31(692)-31(701):METHOD_INVOCATION:ctx.body()
<A NAME="token22">22:</A>32(709)-32(709):BLOCK_END:}
<A NAME="token23">23:</A>32(709)-32(709):IF_END:}
<A NAME="token24">24:</A>34(720)-34(739):IF:if (app=="/newgame")
<A NAME="token25">25:</A>34(741)-34(741):BLOCK:{
<A NAME="token26">26:</A>35(749)-35(779):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token27">27:</A>36(786)-36(786):BLOCK_END:}
<A NAME="token28">28:</A>36(786)-36(786):IF_END:}
<A NAME="token29">29:</A>39(825)-39(846):IF:if (app=="/startgame")
<A NAME="token30">30:</A>39(848)-39(848):BLOCK:{
<A NAME="token31">31:</A>40(856)-40(883):METHOD_INVOCATION:boardController.resetBoard()
<A NAME="token32">32:</A>41(899)-41(916):VARIABLE_DECLARATION:paras = ctx.body()
<A NAME="token33">33:</A>41(907)-41(916):METHOD_INVOCATION:ctx.body()
<A NAME="token34">34:</A>43(971)-43(1010):VARIABLE_DECLARATION:type1 = paras.charAt(paras.length() - 1)
<A NAME="token35">35:</A>43(979)-43(1010):METHOD_INVOCATION:paras.charAt(paras.length() - 1)
<A NAME="token36">36:</A>43(992)-43(1005):METHOD_INVOCATION:paras.length()
<A NAME="token37">37:</A>44(1024)-44(1057):VARIABLE_DECLARATION:type2 = (type1 == 'X') ? 'O' : 'X'
<A NAME="token38">38:</A>45(1073)-45(1097):VARIABLE_DECLARATION:p1 = new Player(type1, 1)
<A NAME="token39">39:</A>45(1078)-45(1097):NEW:new Player(type1, 1)
<A NAME="token40">40:</A>46(1113)-46(1137):VARIABLE_DECLARATION:p2 = new Player(type2, 2)
<A NAME="token41">41:</A>46(1118)-46(1137):NEW:new Player(type2, 2)
<A NAME="token42">42:</A>47(1146)-47(1171):METHOD_INVOCATION:boardController.getBoard()
<A NAME="token43">43:</A>47(1146)-47(1181):METHOD_INVOCATION:boardController.getBoard().setP1(p1)
<A NAME="token44">44:</A>48(1190)-48(1215):METHOD_INVOCATION:boardController.getBoard()
<A NAME="token45">45:</A>48(1190)-48(1225):METHOD_INVOCATION:boardController.getBoard().setP2(p2)
<A NAME="token46">46:</A>49(1241)-49(1288):VARIABLE_DECLARATION:boardJson = boardController.getBoardJsonString()
<A NAME="token47">47:</A>49(1253)-49(1288):METHOD_INVOCATION:boardController.getBoardJsonString()
<A NAME="token48">48:</A>50(1297)-50(1317):METHOD_INVOCATION:ctx.result(boardJson)
<A NAME="token49">49:</A>51(1324)-51(1324):BLOCK_END:}
<A NAME="token50">50:</A>51(1324)-51(1324):IF_END:}
<A NAME="token51">51:</A>54(1362)-54(1382):IF:if (app=="/joingame")
<A NAME="token52">52:</A>54(1384)-54(1384):BLOCK:{
<A NAME="token53">53:</A>55(1392)-55(1417):METHOD_INVOCATION:boardController.getBoard()
<A NAME="token54">54:</A>55(1392)-55(1438):METHOD_INVOCATION:boardController.getBoard().setGameStarted(true)
<A NAME="token55">55:</A>56(1454)-56(1501):VARIABLE_DECLARATION:boardJson = boardController.getBoardJsonString()
<A NAME="token56">56:</A>56(1466)-56(1501):METHOD_INVOCATION:boardController.getBoardJsonString()
<A NAME="token57">57:</A>57(1510)-57(1545):METHOD_INVOCATION:sendGameBoardToAllPlayers(boardJson)
<A NAME="token58">58:</A>58(1554)-58(1588):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token59">59:</A>59(1595)-59(1595):BLOCK_END:}
<A NAME="token60">60:</A>59(1595)-59(1595):IF_END:}
<A NAME="token61">61:</A>62(1623)-62(1649):IF:if (app=="/move/:playerId")
<A NAME="token62">62:</A>62(1651)-62(1651):BLOCK:{
<A NAME="token63">63:</A>63(1663)-63(1716):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token64">64:</A>63(1674)-63(1716):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token65">65:</A>63(1691)-63(1715):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token66">66:</A>64(1732)-64(1789):VARIABLE_DECLARATION:curPlayer = boardController.getBoard().getPlayer(playerId)
<A NAME="token67">67:</A>64(1744)-64(1769):METHOD_INVOCATION:boardController.getBoard()
<A NAME="token68">68:</A>64(1744)-64(1789):METHOD_INVOCATION:boardController.getBoard().getPlayer(playerId)
<A NAME="token69">69:</A>65(1822)-65(1859):VARIABLE_DECLARATION:paraMap = getParametersMap(ctx.body())
<A NAME="token70">70:</A>65(1832)-65(1859):METHOD_INVOCATION:getParametersMap(ctx.body())
<A NAME="token71">71:</A>65(1849)-65(1858):METHOD_INVOCATION:ctx.body()
<A NAME="token72">72:</A>66(1872)-66(1909):VARIABLE_DECLARATION:x = Integer.parseInt(paraMap.get("x"))
<A NAME="token73">73:</A>66(1876)-66(1909):METHOD_INVOCATION:Integer.parseInt(paraMap.get("x"))
<A NAME="token74">74:</A>66(1893)-66(1908):METHOD_INVOCATION:paraMap.get("x")
<A NAME="token75">75:</A>67(1922)-67(1959):VARIABLE_DECLARATION:y = Integer.parseInt(paraMap.get("y"))
<A NAME="token76">76:</A>67(1926)-67(1959):METHOD_INVOCATION:Integer.parseInt(paraMap.get("y"))
<A NAME="token77">77:</A>67(1943)-67(1958):METHOD_INVOCATION:paraMap.get("y")
<A NAME="token78">78:</A>68(1973)-68(2008):VARIABLE_DECLARATION:newMove =  new Move(curPlayer, x, y)
<A NAME="token79">79:</A>68(1984)-68(2008):NEW:new Move(curPlayer, x, y)
<A NAME="token80">80:</A>69(2025)-69(2068):VARIABLE_DECLARATION:message = boardController.validMove(newMove)
<A NAME="token81">81:</A>69(2035)-69(2068):METHOD_INVOCATION:boardController.validMove(newMove)
<A NAME="token82">82:</A>72(2113)-72(2142):IF:if (message.getMoveValidity())
<A NAME="token83">83:</A>72(2117)-72(2141):METHOD_INVOCATION:message.getMoveValidity()
<A NAME="token84">84:</A>72(2144)-72(2144):BLOCK:{
<A NAME="token85">85:</A>73(2154)-73(2186):METHOD_INVOCATION:boardController.makeMove(newMove)
<A NAME="token86">86:</A>74(2204)-74(2251):VARIABLE_DECLARATION:boardJson = boardController.getBoardJsonString()
<A NAME="token87">87:</A>74(2216)-74(2251):METHOD_INVOCATION:boardController.getBoardJsonString()
<A NAME="token88">88:</A>75(2262)-75(2297):METHOD_INVOCATION:sendGameBoardToAllPlayers(boardJson)
<A NAME="token89">89:</A>76(2306)-76(2306):BLOCK_END:}
<A NAME="token90">90:</A>76(2306)-76(2306):IF_END:}
<A NAME="token91">91:</A>78(2321)-78(2358):METHOD_INVOCATION:ctx.result(new Gson().toJson(message))
<A NAME="token92">92:</A>78(2332)-78(2341):NEW:new Gson()
<A NAME="token93">93:</A>78(2332)-78(2357):METHOD_INVOCATION:new Gson().toJson(message)
<A NAME="token94">94:</A>79(2365)-79(2365):BLOCK_END:}
<A NAME="token95">95:</A>79(2365)-79(2365):IF_END:}
<A NAME="token96">96:</A>82(2417)-82(2455):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token97">97:</A>82(2438)-82(2454):NEW:new UiWebSocket()
<A NAME="token98">98:</A>83(2460)-83(2460):METHOD_DECLARATION_END:}
<A NAME="token99">99:</A>90(2642)-90(2676):METHOD_DECLARATION:getParametersMap(String paraJson) {
<A NAME="token100">100:</A>91(2691)-91(2717):VARIABLE_DECLARATION:paras = paraJson.split("&amp;")
<A NAME="token101">101:</A>91(2699)-91(2717):METHOD_INVOCATION:paraJson.split("&amp;")
<A NAME="token102">102:</A>92(2748)-92(2786):VARIABLE_DECLARATION:paraMap = new HashMap&lt;String, String&gt;()
<A NAME="token103">103:</A>92(2758)-92(2786):NEW:new HashMap&lt;String, String&gt;()
<A NAME="token104">104:</A>93(2793)-93(2830):FOR:for (int i = 0; i &lt; paras.length; i++)
<A NAME="token105">105:</A>93(2802)-93(2806):VARIABLE_DECLARATION:i = 0
<A NAME="token106">106:</A>93(2827)-93(2829):ASSIGNMENT:i++
<A NAME="token107">107:</A>93(2832)-93(2832):BLOCK:{
<A NAME="token108">108:</A>94(2849)-94(2875):VARIABLE_DECLARATION:attrs = paras[i].split("=")
<A NAME="token109">109:</A>94(2857)-94(2875):METHOD_INVOCATION:paras[i].split("=")
<A NAME="token110">110:</A>95(2884)-95(2914):METHOD_INVOCATION:paraMap.put(attrs[0], attrs[1])
<A NAME="token111">111:</A>96(2921)-96(2921):BLOCK_END:}
<A NAME="token112">112:</A>96(2921)-96(2921):FOR_END:}
<A NAME="token113">113:</A>97(2927)-97(2941):RETURN:return paraMap;
<A NAME="token114">114:</A>98(2945)-98(2945):METHOD_DECLARATION_END:}
<A NAME="token115">115:</A>104(3115)-104(3169):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token116">116:</A>105(3190)-105(3225):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token117">117:</A>105(3201)-105(3225):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token118">118:</A>106(3245)-106(3292):VARIABLE_DECLARATION:logger = LoggerFactory.getLogger(PlayGame.class)
<A NAME="token119">119:</A>106(3254)-106(3292):METHOD_INVOCATION:LoggerFactory.getLogger(PlayGame.class)
<A NAME="token120">120:</A>107(3299)-107(3336):FOR:for (Session sessionPlayer : sessions)
<A NAME="token121">121:</A>107(3338)-107(3338):BLOCK:{
<A NAME="token122">122:</A>108(3346)-108(3350):TRY:try {
<A NAME="token123">123:</A>109(3360)-109(3384):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token124">124:</A>109(3360)-109(3410):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token125">125:</A>110(3419)-110(3419):TRY_END:}
<A NAME="token126">126:</A>110(3421)-110(3443):CATCH:catch (IOException e) {
<A NAME="token127">127:</A>112(3480)-112(3505):METHOD_INVOCATION:logger.error(e.toString())
<A NAME="token128">128:</A>112(3493)-112(3504):METHOD_INVOCATION:e.toString()
<A NAME="token129">129:</A>113(3514)-113(3514):CATCH_END:}
<A NAME="token130">130:</A>114(3520)-114(3520):BLOCK_END:}
<A NAME="token131">131:</A>114(3520)-114(3520):FOR_END:}
<A NAME="token132">132:</A>115(3524)-115(3524):METHOD_DECLARATION_END:}
<A NAME="token133">133:</A>117(3548)-117(3555):METHOD_DECLARATION:stop() {
<A NAME="token134">134:</A>118(3561)-118(3570):METHOD_INVOCATION:app.stop()
<A NAME="token135">135:</A>119(3575)-119(3575):METHOD_DECLARATION_END:}
<A NAME="token136">136:</A>120(3577)-120(3577):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
