<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(153):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token6">6:</A>8(155)-8(176):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(178)-9(196):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(198)-10(218):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(220)-11(266):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>11(266)-13(284):CLASS_DECLARATION:;
<A NAME="token11">11:</A>15(314)-15(331):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token12">12:</A>17(360)-17(362):VARIABLE_DECLARATION:app
<A NAME="token13">13:</A>22(471)-22(497):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token14">14:</A>27(530)-27(546):IF:if (app=="/echo")
<A NAME="token15">15:</A>27(548)-27(548):BLOCK:{
<A NAME="token16">16:</A>28(556)-28(577):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token17">17:</A>28(567)-28(576):METHOD_INVOCATION:ctx.body()
<A NAME="token18">18:</A>29(584)-29(584):BLOCK_END:}
<A NAME="token19">19:</A>29(584)-29(584):IF_END:}
<A NAME="token20">20:</A>31(601)-31(627):VARIABLE_DECLARATION:gameBoard = new GameBoard()
<A NAME="token21">21:</A>31(613)-31(627):NEW:new GameBoard()
<A NAME="token22">22:</A>33(639)-33(658):IF:if (app=="/newgame")
<A NAME="token23">23:</A>33(660)-33(660):BLOCK:{
<A NAME="token24">24:</A>34(668)-34(688):METHOD_INVOCATION:gameBoard.startOver()
<A NAME="token25">25:</A>35(697)-35(727):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token26">26:</A>36(734)-36(734):BLOCK_END:}
<A NAME="token27">27:</A>36(734)-36(734):IF_END:}
<A NAME="token28">28:</A>38(745)-38(766):IF:if (app=="/startgame")
<A NAME="token29">29:</A>38(768)-38(768):BLOCK:{
<A NAME="token30">30:</A>39(783)-39(810):VARIABLE_DECLARATION:type = ctx.formParam("type")
<A NAME="token31">31:</A>39(790)-39(810):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token32">32:</A>40(819)-40(839):IF:if (type.equals("X"))
<A NAME="token33">33:</A>40(823)-40(838):METHOD_INVOCATION:type.equals("X")
<A NAME="token34">34:</A>40(841)-40(841):BLOCK:{
<A NAME="token35">35:</A>41(851)-41(875):METHOD_INVOCATION:gameBoard.setPlayer1('X')
<A NAME="token36">36:</A>42(884)-42(884):BLOCK_END:}
<A NAME="token37">37:</A>42(884)-42(884):IF_END:}
<A NAME="token38">38:</A>42(886)-42(889):ELSE:else
<A NAME="token39">39:</A>42(891)-42(891):BLOCK:{
<A NAME="token40">40:</A>43(901)-43(925):METHOD_INVOCATION:gameBoard.setPlayer1('O')
<A NAME="token41">41:</A>44(934)-44(934):BLOCK_END:}
<A NAME="token42">42:</A>44(934)-44(934):ELSE_END:}
<A NAME="token43">43:</A>45(947)-45(963):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token44">44:</A>45(954)-45(963):NEW:new Gson()
<A NAME="token45">45:</A>46(972)-46(1005):METHOD_INVOCATION:ctx.result(gson.toJson(gameBoard))
<A NAME="token46">46:</A>46(983)-46(1004):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token47">47:</A>47(1012)-47(1012):BLOCK_END:}
<A NAME="token48">48:</A>47(1012)-47(1012):IF_END:}
<A NAME="token49">49:</A>49(1023)-49(1043):IF:if (app=="/joingame")
<A NAME="token50">50:</A>49(1045)-49(1045):BLOCK:{
<A NAME="token51">51:</A>50(1053)-50(1096):IF:if (gameBoard.getPlayer1().getType() == 'X')
<A NAME="token52">52:</A>50(1057)-50(1078):METHOD_INVOCATION:gameBoard.getPlayer1()
<A NAME="token53">53:</A>50(1057)-50(1088):METHOD_INVOCATION:gameBoard.getPlayer1().getType()
<A NAME="token54">54:</A>50(1098)-50(1098):BLOCK:{
<A NAME="token55">55:</A>51(1108)-51(1132):METHOD_INVOCATION:gameBoard.setPlayer2('O')
<A NAME="token56">56:</A>52(1141)-52(1141):BLOCK_END:}
<A NAME="token57">57:</A>52(1141)-52(1141):IF_END:}
<A NAME="token58">58:</A>52(1143)-52(1146):ELSE:else
<A NAME="token59">59:</A>52(1148)-52(1148):BLOCK:{
<A NAME="token60">60:</A>53(1158)-53(1182):METHOD_INVOCATION:gameBoard.setPlayer2('X')
<A NAME="token61">61:</A>54(1191)-54(1191):BLOCK_END:}
<A NAME="token62">62:</A>54(1191)-54(1191):ELSE_END:}
<A NAME="token63">63:</A>55(1199)-55(1219):METHOD_INVOCATION:gameBoard.startGame()
<A NAME="token64">64:</A>56(1233)-56(1249):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token65">65:</A>56(1240)-56(1249):NEW:new Gson()
<A NAME="token66">66:</A>57(1258)-57(1306):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token67">67:</A>57(1284)-57(1305):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token68">68:</A>58(1315)-58(1349):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token69">69:</A>59(1356)-59(1356):BLOCK_END:}
<A NAME="token70">70:</A>59(1356)-59(1356):IF_END:}
<A NAME="token71">71:</A>61(1367)-61(1393):IF:if (app=="/move/:playerId")
<A NAME="token72">72:</A>61(1395)-61(1395):BLOCK:{
<A NAME="token73">73:</A>62(1407)-62(1454):VARIABLE_DECLARATION:id = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token74">74:</A>62(1412)-62(1454):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token75">75:</A>62(1429)-62(1453):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token76">76:</A>63(1467)-63(1506):VARIABLE_DECLARATION:x = Integer.parseInt(ctx.formParam("x"))
<A NAME="token77">77:</A>63(1471)-63(1506):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token78">78:</A>63(1488)-63(1505):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token79">79:</A>64(1519)-64(1558):VARIABLE_DECLARATION:y = Integer.parseInt(ctx.formParam("y"))
<A NAME="token80">80:</A>64(1523)-64(1558):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token81">81:</A>64(1540)-64(1557):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token82">82:</A>65(1574)-65(1579):VARIABLE_DECLARATION:player
<A NAME="token83">83:</A>66(1588)-66(1599):IF:if (id == 1)
<A NAME="token84">84:</A>66(1601)-66(1601):BLOCK:{
<A NAME="token85">85:</A>67(1611)-67(1641):ASSIGNMENT:player = gameBoard.getPlayer1()
<A NAME="token86">86:</A>67(1620)-67(1641):METHOD_INVOCATION:gameBoard.getPlayer1()
<A NAME="token87">87:</A>68(1650)-68(1650):BLOCK_END:}
<A NAME="token88">88:</A>68(1650)-68(1650):IF_END:}
<A NAME="token89">89:</A>68(1652)-68(1655):ELSE:else
<A NAME="token90">90:</A>68(1657)-68(1657):BLOCK:{
<A NAME="token91">91:</A>69(1667)-69(1697):ASSIGNMENT:player = gameBoard.getPlayer2()
<A NAME="token92">92:</A>69(1676)-69(1697):METHOD_INVOCATION:gameBoard.getPlayer2()
<A NAME="token93">93:</A>70(1706)-70(1706):BLOCK_END:}
<A NAME="token94">94:</A>70(1706)-70(1706):ELSE_END:}
<A NAME="token95">95:</A>71(1719)-71(1747):VARIABLE_DECLARATION:move = new Move(player, x, y)
<A NAME="token96">96:</A>71(1726)-71(1747):NEW:new Move(player, x, y)
<A NAME="token97">97:</A>72(1764)-72(1795):VARIABLE_DECLARATION:result = gameBoard.tryMove(move)
<A NAME="token98">98:</A>72(1773)-72(1795):METHOD_INVOCATION:gameBoard.tryMove(move)
<A NAME="token99">99:</A>73(1812)-73(1814):VARIABLE_DECLARATION:msg
<A NAME="token100">100:</A>74(1823)-74(1833):IF:if (result)
<A NAME="token101">101:</A>74(1835)-74(1835):BLOCK:{
<A NAME="token102">102:</A>75(1845)-75(1876):ASSIGNMENT:msg = new Message(true, 100, "")
<A NAME="token103">103:</A>75(1851)-75(1876):NEW:new Message(true, 100, "")
<A NAME="token104">104:</A>76(1885)-76(1885):BLOCK_END:}
<A NAME="token105">105:</A>76(1885)-76(1885):IF_END:}
<A NAME="token106">106:</A>76(1887)-76(1890):ELSE:else
<A NAME="token107">107:</A>76(1892)-76(1892):BLOCK:{
<A NAME="token108">108:</A>77(1902)-77(1946):ASSIGNMENT:msg = new Message(false, 100, "Invalid move")
<A NAME="token109">109:</A>77(1908)-77(1946):NEW:new Message(false, 100, "Invalid move")
<A NAME="token110">110:</A>78(1955)-78(1955):BLOCK_END:}
<A NAME="token111">111:</A>78(1955)-78(1955):ELSE_END:}
<A NAME="token112">112:</A>79(1968)-79(1984):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token113">113:</A>79(1975)-79(1984):NEW:new Gson()
<A NAME="token114">114:</A>80(1993)-80(2020):METHOD_INVOCATION:ctx.result(gson.toJson(msg))
<A NAME="token115">115:</A>80(2004)-80(2019):METHOD_INVOCATION:gson.toJson(msg)
<A NAME="token116">116:</A>81(2029)-81(2077):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token117">117:</A>81(2055)-81(2076):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token118">118:</A>82(2084)-82(2084):BLOCK_END:}
<A NAME="token119">119:</A>82(2084)-82(2084):IF_END:}
<A NAME="token120">120:</A>85(2136)-85(2174):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token121">121:</A>85(2157)-85(2173):NEW:new UiWebSocket()
<A NAME="token122">122:</A>86(2179)-86(2179):METHOD_DECLARATION_END:}
<A NAME="token123">123:</A>92(2347)-92(2401):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token124">124:</A>93(2422)-93(2457):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token125">125:</A>93(2433)-93(2457):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token126">126:</A>94(2464)-94(2501):FOR:for (Session sessionPlayer : sessions)
<A NAME="token127">127:</A>94(2503)-94(2503):BLOCK:{
<A NAME="token128">128:</A>95(2511)-95(2515):TRY:try {
<A NAME="token129">129:</A>96(2525)-96(2549):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token130">130:</A>96(2525)-96(2575):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token131">131:</A>97(2584)-97(2584):TRY_END:}
<A NAME="token132">132:</A>97(2586)-97(2608):CATCH:catch (IOException e) {
<A NAME="token133">133:</A>99(2645)-99(2696):METHOD_INVOCATION:System.out.println("Error with sending to players.")
<A NAME="token134">134:</A>100(2705)-100(2705):CATCH_END:}
<A NAME="token135">135:</A>101(2711)-101(2711):BLOCK_END:}
<A NAME="token136">136:</A>101(2711)-101(2711):FOR_END:}
<A NAME="token137">137:</A>102(2715)-102(2715):METHOD_DECLARATION_END:}
<A NAME="token138">138:</A>104(2739)-104(2746):METHOD_DECLARATION:stop() {
<A NAME="token139">139:</A>105(2752)-105(2761):METHOD_INVOCATION:app.stop()
<A NAME="token140">140:</A>106(2766)-106(2766):METHOD_DECLARATION_END:}
<A NAME="token141">141:</A>107(2768)-107(2768):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
