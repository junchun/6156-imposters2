<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(153):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token6">6:</A>8(155)-8(176):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(178)-9(196):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(198)-10(218):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(220)-11(266):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>11(266)-13(284):CLASS_DECLARATION:;
<A NAME="token11">11:</A>15(314)-15(331):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token12">12:</A>17(360)-17(362):VARIABLE_DECLARATION:app
<A NAME="token13">13:</A>24(482)-24(508):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token14">14:</A>27(539)-27(555):IF:if (app=="/echo")
<A NAME="token15">15:</A>27(557)-27(557):BLOCK:{
<A NAME="token16">16:</A>28(565)-28(586):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token17">17:</A>28(576)-28(585):METHOD_INVOCATION:ctx.body()
<A NAME="token18">18:</A>29(593)-29(593):BLOCK_END:}
<A NAME="token19">19:</A>29(593)-29(593):IF_END:}
<A NAME="token20">20:</A>31(610)-31(636):VARIABLE_DECLARATION:gameBoard = new GameBoard()
<A NAME="token21">21:</A>31(622)-31(636):NEW:new GameBoard()
<A NAME="token22">22:</A>37(775)-37(794):IF:if (app=="/newgame")
<A NAME="token23">23:</A>37(796)-37(796):BLOCK:{
<A NAME="token24">24:</A>38(804)-38(834):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token25">25:</A>39(841)-39(841):BLOCK_END:}
<A NAME="token26">26:</A>39(841)-39(841):IF_END:}
<A NAME="token27">27:</A>45(998)-45(1019):IF:if (app=="/startgame")
<A NAME="token28">28:</A>45(1021)-45(1021):BLOCK:{
<A NAME="token29">29:</A>46(1036)-46(1052):VARIABLE_DECLARATION:p1 = new Player()
<A NAME="token30">30:</A>46(1041)-46(1052):NEW:new Player()
<A NAME="token31">31:</A>47(1061)-47(1071):METHOD_INVOCATION:p1.setId(1)
<A NAME="token32">32:</A>48(1080)-48(1122):METHOD_INVOCATION:p1.setType(ctx.formParam("type").charAt(0))
<A NAME="token33">33:</A>48(1091)-48(1111):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token34">34:</A>48(1091)-48(1121):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token35">35:</A>49(1131)-49(1149):METHOD_INVOCATION:gameBoard.setP1(p1)
<A NAME="token36">36:</A>50(1158)-50(1189):METHOD_INVOCATION:gameBoard.initializeBoardState()
<A NAME="token37">37:</A>51(1203)-51(1219):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token38">38:</A>51(1210)-51(1219):NEW:new Gson()
<A NAME="token39">39:</A>52(1235)-52(1272):VARIABLE_DECLARATION:gameBoardJson = gson.toJson(gameBoard)
<A NAME="token40">40:</A>52(1251)-52(1272):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token41">41:</A>53(1281)-53(1305):METHOD_INVOCATION:ctx.result(gameBoardJson)
<A NAME="token42">42:</A>54(1341)-54(1341):BLOCK_END:}
<A NAME="token43">43:</A>54(1341)-54(1341):IF_END:}
<A NAME="token44">44:</A>61(1595)-61(1615):IF:if (app=="/joingame")
<A NAME="token45">45:</A>61(1617)-61(1617):BLOCK:{
<A NAME="token46">46:</A>62(1632)-62(1648):VARIABLE_DECLARATION:p2 = new Player()
<A NAME="token47">47:</A>62(1637)-62(1648):NEW:new Player()
<A NAME="token48">48:</A>63(1657)-63(1667):METHOD_INVOCATION:p2.setId(2)
<A NAME="token49">49:</A>64(1676)-64(1714):IF:if (gameBoard.getP1().getType() == 'X')
<A NAME="token50">50:</A>64(1680)-64(1696):METHOD_INVOCATION:gameBoard.getP1()
<A NAME="token51">51:</A>64(1680)-64(1706):METHOD_INVOCATION:gameBoard.getP1().getType()
<A NAME="token52">52:</A>64(1716)-64(1716):BLOCK:{
<A NAME="token53">53:</A>65(1726)-65(1740):METHOD_INVOCATION:p2.setType('O')
<A NAME="token54">54:</A>66(1749)-66(1749):BLOCK_END:}
<A NAME="token55">55:</A>66(1749)-66(1749):IF_END:}
<A NAME="token56">56:</A>66(1751)-66(1754):ELSE:else
<A NAME="token57">57:</A>66(1756)-66(1756):BLOCK:{
<A NAME="token58">58:</A>67(1766)-67(1780):METHOD_INVOCATION:p2.setType('X')
<A NAME="token59">59:</A>68(1789)-68(1789):BLOCK_END:}
<A NAME="token60">60:</A>68(1789)-68(1789):ELSE_END:}
<A NAME="token61">61:</A>69(1797)-69(1815):METHOD_INVOCATION:gameBoard.setP2(p2)
<A NAME="token62">62:</A>70(1824)-70(1853):METHOD_INVOCATION:gameBoard.setGameStarted(true)
<A NAME="token63">63:</A>71(1867)-71(1883):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token64">64:</A>71(1874)-71(1883):NEW:new Gson()
<A NAME="token65">65:</A>72(1899)-72(1936):VARIABLE_DECLARATION:gameBoardJson = gson.toJson(gameBoard)
<A NAME="token66">66:</A>72(1915)-72(1936):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token67">67:</A>73(1945)-73(1984):METHOD_INVOCATION:sendGameBoardToAllPlayers(gameBoardJson)
<A NAME="token68">68:</A>75(2031)-75(2065):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token69">69:</A>76(2072)-76(2072):BLOCK_END:}
<A NAME="token70">70:</A>76(2072)-76(2072):IF_END:}
<A NAME="token71">71:</A>81(2189)-81(2215):IF:if (app=="/move/:playerId")
<A NAME="token72">72:</A>81(2217)-81(2217):BLOCK:{
<A NAME="token73">73:</A>83(2274)-83(2290):VARIABLE_DECLARATION:move = new Move()
<A NAME="token74">74:</A>83(2281)-83(2290):NEW:new Move()
<A NAME="token75">75:</A>84(2299)-84(2349):METHOD_INVOCATION:move.setMoveX(Integer.parseInt(ctx.formParam("x")))
<A NAME="token76">76:</A>84(2313)-84(2348):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token77">77:</A>84(2330)-84(2347):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token78">78:</A>86(2387)-86(2437):METHOD_INVOCATION:move.setMoveY(Integer.parseInt(ctx.formParam("y")))
<A NAME="token79">79:</A>86(2401)-86(2436):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token80">80:</A>86(2418)-86(2435):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token81">81:</A>88(2482)-88(2535):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token82">82:</A>88(2493)-88(2535):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token83">83:</A>88(2510)-88(2534):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token84">84:</A>89(2544)-89(2588):METHOD_INVOCATION:move.setPlayer(gameBoard.getPlayer(playerId))
<A NAME="token85">85:</A>89(2559)-89(2587):METHOD_INVOCATION:gameBoard.getPlayer(playerId)
<A NAME="token86">86:</A>90(2605)-90(2627):VARIABLE_DECLARATION:message = new Message()
<A NAME="token87">87:</A>90(2615)-90(2627):NEW:new Message()
<A NAME="token88">88:</A>91(2636)-91(2710):IF:if (gameBoard.checkMoveValidity(move, message) &amp;&amp; gameBoard.makeMove(move))
<A NAME="token89">89:</A>91(2640)-91(2681):METHOD_INVOCATION:gameBoard.checkMoveValidity(move, message)
<A NAME="token90">90:</A>91(2686)-91(2709):METHOD_INVOCATION:gameBoard.makeMove(move)
<A NAME="token91">91:</A>91(2712)-91(2712):BLOCK:{
<A NAME="token92">92:</A>92(2722)-92(2767):METHOD_INVOCATION:gameBoard.setTurn(gameBoard.getTurn() % 2 + 1)
<A NAME="token93">93:</A>92(2740)-92(2758):METHOD_INVOCATION:gameBoard.getTurn()
<A NAME="token94">94:</A>93(2776)-93(2776):BLOCK_END:}
<A NAME="token95">95:</A>93(2776)-93(2776):IF_END:}
<A NAME="token96">96:</A>94(2789)-94(2812):VARIABLE_DECLARATION:messageGson = new Gson()
<A NAME="token97">97:</A>94(2803)-94(2812):NEW:new Gson()
<A NAME="token98">98:</A>95(2828)-95(2868):VARIABLE_DECLARATION:messageJson = messageGson.toJson(message)
<A NAME="token99">99:</A>95(2842)-95(2868):METHOD_INVOCATION:messageGson.toJson(message)
<A NAME="token100">100:</A>96(2877)-96(2899):METHOD_INVOCATION:ctx.result(messageJson)
<A NAME="token101">101:</A>97(2913)-97(2938):VARIABLE_DECLARATION:gameBoardGson = new Gson()
<A NAME="token102">102:</A>97(2929)-97(2938):NEW:new Gson()
<A NAME="token103">103:</A>98(2954)-98(3000):VARIABLE_DECLARATION:gameBoardJson = gameBoardGson.toJson(gameBoard)
<A NAME="token104">104:</A>98(2970)-98(3000):METHOD_INVOCATION:gameBoardGson.toJson(gameBoard)
<A NAME="token105">105:</A>99(3009)-99(3048):METHOD_INVOCATION:sendGameBoardToAllPlayers(gameBoardJson)
<A NAME="token106">106:</A>100(3055)-100(3055):BLOCK_END:}
<A NAME="token107">107:</A>100(3055)-100(3055):IF_END:}
<A NAME="token108">108:</A>103(3107)-103(3145):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token109">109:</A>103(3128)-103(3144):NEW:new UiWebSocket()
<A NAME="token110">110:</A>104(3150)-104(3150):METHOD_DECLARATION_END:}
<A NAME="token111">111:</A>112(3329)-112(3383):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token112">112:</A>113(3404)-113(3439):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token113">113:</A>113(3415)-113(3439):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token114">114:</A>114(3446)-114(3483):FOR:for (Session sessionPlayer : sessions)
<A NAME="token115">115:</A>114(3485)-114(3485):BLOCK:{
<A NAME="token116">116:</A>115(3493)-115(3497):TRY:try {
<A NAME="token117">117:</A>116(3507)-116(3531):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token118">118:</A>116(3507)-116(3557):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token119">119:</A>117(3566)-117(3566):TRY_END:}
<A NAME="token120">120:</A>117(3568)-117(3590):CATCH:catch (IOException e) {
<A NAME="token121">121:</A>119(3625)-119(3625):CATCH_END:}
<A NAME="token122">122:</A>120(3631)-120(3631):BLOCK_END:}
<A NAME="token123">123:</A>120(3631)-120(3631):FOR_END:}
<A NAME="token124">124:</A>121(3635)-121(3635):METHOD_DECLARATION_END:}
<A NAME="token125">125:</A>123(3659)-123(3666):METHOD_DECLARATION:stop() {
<A NAME="token126">126:</A>124(3672)-124(3681):METHOD_INVOCATION:app.stop()
<A NAME="token127">127:</A>125(3686)-125(3686):METHOD_DECLARATION_END:}
<A NAME="token128">128:</A>126(3688)-126(3688):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
