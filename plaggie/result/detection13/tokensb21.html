<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(160):IMPORT_DECLARATION:import java.util.regex.Pattern;
<A NAME="token6">6:</A>8(162)-8(185):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token7">7:</A>9(187)-9(208):IMPORT_DECLARATION:import models.Message;
<A NAME="token8">8:</A>10(210)-10(228):IMPORT_DECLARATION:import models.Move;
<A NAME="token9">9:</A>11(230)-11(250):IMPORT_DECLARATION:import models.Player;
<A NAME="token10">10:</A>12(252)-12(298):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token11">11:</A>12(298)-14(316):CLASS_DECLARATION:;
<A NAME="token12">12:</A>16(346)-16(363):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token13">13:</A>18(392)-18(394):VARIABLE_DECLARATION:app
<A NAME="token14">14:</A>21(523)-21(565):VARIABLE_DECLARATION:gameBoardManager = new GameBoard[] { null }
<A NAME="token15">15:</A>23(593)-23(609):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token16">16:</A>23(600)-23(609):NEW:new Gson()
<A NAME="token17">17:</A>28(718)-28(744):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token18">18:</A>33(777)-33(793):IF:if (app=="/echo")
<A NAME="token19">19:</A>33(795)-33(795):BLOCK:{
<A NAME="token20">20:</A>34(803)-34(824):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token21">21:</A>34(814)-34(823):METHOD_INVOCATION:ctx.body()
<A NAME="token22">22:</A>35(831)-35(831):BLOCK_END:}
<A NAME="token23">23:</A>35(831)-35(831):IF_END:}
<A NAME="token24">24:</A>38(867)-38(886):IF:if (app=="/newgame")
<A NAME="token25">25:</A>38(888)-38(888):BLOCK:{
<A NAME="token26">26:</A>39(896)-39(932):ASSIGNMENT:gameBoardManager[0] = new GameBoard()
<A NAME="token27">27:</A>39(918)-39(932):NEW:new GameBoard()
<A NAME="token28">28:</A>40(941)-40(971):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token29">29:</A>41(978)-41(978):BLOCK_END:}
<A NAME="token30">30:</A>41(978)-41(978):IF_END:}
<A NAME="token31">31:</A>44(1067)-44(1088):IF:if (app=="/startgame")
<A NAME="token32">32:</A>44(1090)-44(1090):BLOCK:{
<A NAME="token33">33:</A>45(1098)-45(1122):METHOD_INVOCATION:validateActiveGameBoard()
<A NAME="token34">34:</A>47(1148)-47(1178):VARIABLE_DECLARATION:gameBoard = gameBoardManager[0]
<A NAME="token35">35:</A>49(1201)-49(1220):VARIABLE_DECLARATION:request = ctx.body()
<A NAME="token36">36:</A>49(1211)-49(1220):METHOD_INVOCATION:ctx.body()
<A NAME="token37">37:</A>51(1230)-51(1272):IF:if (!Pattern.matches("type=[XO]", request))
<A NAME="token38">38:</A>51(1235)-51(1271):METHOD_INVOCATION:Pattern.matches("type=[XO]", request)
<A NAME="token39">39:</A>51(1274)-51(1274):BLOCK:{
<A NAME="token40">40:</A>52(1284)-52(1362):THROW:throw new RuntimeException("Improperly formatted input to startgame endpoint");
<A NAME="token41">41:</A>52(1290)-52(1361):NEW:new RuntimeException("Improperly formatted input to startgame endpoint")
<A NAME="token42">42:</A>53(1370)-53(1370):BLOCK_END:}
<A NAME="token43">43:</A>53(1370)-53(1370):IF_END:}
<A NAME="token44">44:</A>55(1379)-55(1427):METHOD_INVOCATION:gameBoard.setP1(new Player(1, request.charAt(5)))
<A NAME="token45">45:</A>55(1395)-55(1426):NEW:new Player(1, request.charAt(5))
<A NAME="token46">46:</A>55(1409)-55(1425):METHOD_INVOCATION:request.charAt(5)
<A NAME="token47">47:</A>57(1437)-57(1467):ASSIGNMENT:gameBoardManager[0] = gameBoard
<A NAME="token48">48:</A>58(1476)-58(1509):METHOD_INVOCATION:ctx.result(gson.toJson(gameBoard))
<A NAME="token49">49:</A>58(1487)-58(1508):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token50">50:</A>59(1516)-59(1516):BLOCK_END:}
<A NAME="token51">51:</A>59(1516)-59(1516):IF_END:}
<A NAME="token52">52:</A>61(1527)-61(1547):IF:if (app=="/joingame")
<A NAME="token53">53:</A>61(1549)-61(1549):BLOCK:{
<A NAME="token54">54:</A>62(1557)-62(1581):METHOD_INVOCATION:validateActiveGameBoard()
<A NAME="token55">55:</A>63(1590)-63(1612):METHOD_INVOCATION:validateActivePlayer1()
<A NAME="token56">56:</A>65(1638)-65(1668):VARIABLE_DECLARATION:gameBoard = gameBoardManager[0]
<A NAME="token57">57:</A>67(1689)-67(1694):VARIABLE_DECLARATION:p2Type
<A NAME="token58">58:</A>69(1710)-69(1748):IF:if (gameBoard.getP1().getType() == 'X')
<A NAME="token59">59:</A>69(1714)-69(1730):METHOD_INVOCATION:gameBoard.getP1()
<A NAME="token60">60:</A>69(1714)-69(1740):METHOD_INVOCATION:gameBoard.getP1().getType()
<A NAME="token61">61:</A>69(1750)-69(1750):BLOCK:{
<A NAME="token62">62:</A>70(1760)-70(1771):ASSIGNMENT:p2Type = 'O'
<A NAME="token63">63:</A>71(1780)-71(1780):BLOCK_END:}
<A NAME="token64">64:</A>71(1780)-71(1780):IF_END:}
<A NAME="token65">65:</A>71(1782)-71(1785):ELSE:else
<A NAME="token66">66:</A>71(1787)-71(1787):BLOCK:{
<A NAME="token67">67:</A>72(1797)-72(1808):ASSIGNMENT:p2Type = 'X'
<A NAME="token68">68:</A>73(1817)-73(1817):BLOCK_END:}
<A NAME="token69">69:</A>73(1817)-73(1817):ELSE_END:}
<A NAME="token70">70:</A>75(1832)-75(1869):METHOD_INVOCATION:gameBoard.setP2(new Player(2, p2Type))
<A NAME="token71">71:</A>75(1848)-75(1868):NEW:new Player(2, p2Type)
<A NAME="token72">72:</A>77(1885)-77(1905):METHOD_INVOCATION:gameBoard.startGame()
<A NAME="token73">73:</A>79(1915)-79(1945):ASSIGNMENT:gameBoardManager[0] = gameBoard
<A NAME="token74">74:</A>80(1954)-80(2002):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token75">75:</A>80(1980)-80(2001):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token76">76:</A>81(2011)-81(2045):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token77">77:</A>82(2052)-82(2052):BLOCK_END:}
<A NAME="token78">78:</A>82(2052)-82(2052):IF_END:}
<A NAME="token79">79:</A>84(2059)-84(2085):IF:if (app=="/move/:playerId")
<A NAME="token80">80:</A>84(2087)-84(2087):BLOCK:{
<A NAME="token81">81:</A>85(2095)-85(2119):METHOD_INVOCATION:validateActiveGameBoard()
<A NAME="token82">82:</A>86(2128)-86(2150):METHOD_INVOCATION:validateActivePlayer1()
<A NAME="token83">83:</A>87(2159)-87(2181):METHOD_INVOCATION:validateActivePlayer2()
<A NAME="token84">84:</A>89(2207)-89(2237):VARIABLE_DECLARATION:gameBoard = gameBoardManager[0]
<A NAME="token85">85:</A>91(2260)-91(2279):VARIABLE_DECLARATION:request = ctx.body()
<A NAME="token86">86:</A>91(2270)-91(2279):METHOD_INVOCATION:ctx.body()
<A NAME="token87">87:</A>93(2295)-93(2343):IF:if (!Pattern.matches("x=[012]&amp;y=[012]", request))
<A NAME="token88">88:</A>93(2300)-93(2342):METHOD_INVOCATION:Pattern.matches("x=[012]&amp;y=[012]", request)
<A NAME="token89">89:</A>93(2345)-93(2345):BLOCK:{
<A NAME="token90">90:</A>94(2355)-94(2428):THROW:throw new RuntimeException("Improperly formatted input to move endpoint");
<A NAME="token91">91:</A>94(2361)-94(2427):NEW:new RuntimeException("Improperly formatted input to move endpoint")
<A NAME="token92">92:</A>95(2436)-95(2436):BLOCK_END:}
<A NAME="token93">93:</A>95(2436)-95(2436):IF_END:}
<A NAME="token94">94:</A>97(2455)-97(2508):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token95">95:</A>97(2466)-97(2508):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token96">96:</A>97(2483)-97(2507):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token97">97:</A>99(2531)-99(2572):VARIABLE_DECLARATION:player = gameBoard.getPlayerById(playerId)
<A NAME="token98">98:</A>99(2540)-99(2572):METHOD_INVOCATION:gameBoard.getPlayerById(playerId)
<A NAME="token99">99:</A>100(2585)-100(2636):VARIABLE_DECLARATION:moveX = Character.getNumericValue(request.charAt(2))
<A NAME="token100">100:</A>100(2593)-100(2636):METHOD_INVOCATION:Character.getNumericValue(request.charAt(2))
<A NAME="token101">101:</A>100(2619)-100(2635):METHOD_INVOCATION:request.charAt(2)
<A NAME="token102">102:</A>101(2649)-101(2700):VARIABLE_DECLARATION:moveY = Character.getNumericValue(request.charAt(6))
<A NAME="token103">103:</A>101(2657)-101(2700):METHOD_INVOCATION:Character.getNumericValue(request.charAt(6))
<A NAME="token104">104:</A>101(2683)-101(2699):METHOD_INVOCATION:request.charAt(6)
<A NAME="token105">105:</A>103(2721)-103(2757):VARIABLE_DECLARATION:move = new Move(player, moveX, moveY)
<A NAME="token106">106:</A>103(2728)-103(2757):NEW:new Move(player, moveX, moveY)
<A NAME="token107">107:</A>105(2781)-105(2817):VARIABLE_DECLARATION:message = gameBoard.attemptMove(move)
<A NAME="token108">108:</A>105(2791)-105(2817):METHOD_INVOCATION:gameBoard.attemptMove(move)
<A NAME="token109">109:</A>106(2826)-106(2856):ASSIGNMENT:gameBoardManager[0] = gameBoard
<A NAME="token110">110:</A>107(2865)-107(2913):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token111">111:</A>107(2891)-107(2912):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token112">112:</A>108(2922)-108(2953):METHOD_INVOCATION:ctx.result(gson.toJson(message))
<A NAME="token113">113:</A>108(2933)-108(2952):METHOD_INVOCATION:gson.toJson(message)
<A NAME="token114">114:</A>109(2960)-109(2960):BLOCK_END:}
<A NAME="token115">115:</A>109(2960)-109(2960):IF_END:}
<A NAME="token116">116:</A>112(3012)-112(3050):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token117">117:</A>112(3033)-112(3049):NEW:new UiWebSocket()
<A NAME="token118">118:</A>113(3055)-113(3055):METHOD_DECLARATION_END:}
<A NAME="token119">119:</A>118(3177)-118(3203):METHOD_DECLARATION:validateActiveGameBoard() {
<A NAME="token120">120:</A>119(3209)-119(3240):IF:if (gameBoardManager[0] == null)
<A NAME="token121">121:</A>119(3242)-119(3242):BLOCK:{
<A NAME="token122">122:</A>120(3250)-120(3324):THROW:throw new RuntimeException("Trying to use GameBoard before starting game");
<A NAME="token123">123:</A>120(3256)-120(3323):NEW:new RuntimeException("Trying to use GameBoard before starting game")
<A NAME="token124">124:</A>121(3330)-121(3330):BLOCK_END:}
<A NAME="token125">125:</A>121(3330)-121(3330):IF_END:}
<A NAME="token126">126:</A>122(3334)-122(3334):METHOD_DECLARATION_END:}
<A NAME="token127">127:</A>127(3465)-127(3489):METHOD_DECLARATION:validateActivePlayer1() {
<A NAME="token128">128:</A>128(3495)-128(3534):IF:if (gameBoardManager[0].getP1() == null)
<A NAME="token129">129:</A>128(3499)-128(3525):METHOD_INVOCATION:gameBoardManager[0].getP1()
<A NAME="token130">130:</A>128(3536)-128(3536):BLOCK:{
<A NAME="token131">131:</A>129(3544)-129(3631):THROW:throw new RuntimeException("Trying to use Player1 before Player1 has been initialized");
<A NAME="token132">132:</A>129(3550)-129(3630):NEW:new RuntimeException("Trying to use Player1 before Player1 has been initialized")
<A NAME="token133">133:</A>130(3637)-130(3637):BLOCK_END:}
<A NAME="token134">134:</A>130(3637)-130(3637):IF_END:}
<A NAME="token135">135:</A>131(3641)-131(3641):METHOD_DECLARATION_END:}
<A NAME="token136">136:</A>136(3772)-136(3796):METHOD_DECLARATION:validateActivePlayer2() {
<A NAME="token137">137:</A>137(3802)-137(3841):IF:if (gameBoardManager[0].getP2() == null)
<A NAME="token138">138:</A>137(3806)-137(3832):METHOD_INVOCATION:gameBoardManager[0].getP2()
<A NAME="token139">139:</A>137(3843)-137(3843):BLOCK:{
<A NAME="token140">140:</A>138(3851)-138(3938):THROW:throw new RuntimeException("Trying to use Player2 before Player2 has been initialized");
<A NAME="token141">141:</A>138(3857)-138(3937):NEW:new RuntimeException("Trying to use Player2 before Player2 has been initialized")
<A NAME="token142">142:</A>139(3944)-139(3944):BLOCK_END:}
<A NAME="token143">143:</A>139(3944)-139(3944):IF_END:}
<A NAME="token144">144:</A>140(3948)-140(3948):METHOD_DECLARATION_END:}
<A NAME="token145">145:</A>146(4116)-146(4170):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token146">146:</A>147(4191)-147(4226):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token147">147:</A>147(4202)-147(4226):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token148">148:</A>149(4238)-149(4275):FOR:for (Session sessionPlayer : sessions)
<A NAME="token149">149:</A>149(4277)-149(4277):BLOCK:{
<A NAME="token150">150:</A>150(4285)-150(4289):TRY:try {
<A NAME="token151">151:</A>151(4299)-151(4323):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token152">152:</A>151(4299)-151(4349):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token153">153:</A>152(4358)-152(4358):TRY_END:}
<A NAME="token154">154:</A>152(4360)-152(4382):CATCH:catch (IOException e) {
<A NAME="token155">155:</A>154(4417)-154(4417):CATCH_END:}
<A NAME="token156">156:</A>155(4423)-155(4423):BLOCK_END:}
<A NAME="token157">157:</A>155(4423)-155(4423):FOR_END:}
<A NAME="token158">158:</A>156(4427)-156(4427):METHOD_DECLARATION_END:}
<A NAME="token159">159:</A>158(4451)-158(4458):METHOD_DECLARATION:stop() {
<A NAME="token160">160:</A>159(4464)-159(4473):METHOD_INVOCATION:app.stop()
<A NAME="token161">161:</A>160(4478)-160(4478):METHOD_DECLARATION_END:}
<A NAME="token162">162:</A>161(4480)-161(4480):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
