<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(45):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token2">2:</A>4(47)-4(68):IMPORT_DECLARATION:import models.Message;
<A NAME="token3">3:</A>5(70)-5(90):IMPORT_DECLARATION:import models.Player;
<A NAME="token4">4:</A>7(93)-7(120):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token5">5:</A>8(122)-8(147):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token6">6:</A>9(149)-9(175):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token7">7:</A>10(177)-10(199):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token8">8:</A>11(201)-11(237):IMPORT_DECLARATION:import java.util.concurrent.TimeUnit;
<A NAME="token9">9:</A>12(239)-12(285):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>14(288)-14(310):CLASS_DECLARATION:public class PlayGame {
<A NAME="token11">11:</A>16(340)-16(357):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token12">12:</A>18(386)-18(388):VARIABLE_DECLARATION:app
<A NAME="token13">13:</A>20(421)-20(425):VARIABLE_DECLARATION:board
<A NAME="token14">14:</A>25(534)-25(560):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token15">15:</A>28(596)-28(615):IF:if (app=="/newgame")
<A NAME="token16">16:</A>28(617)-28(617):BLOCK:{
<A NAME="token17">17:</A>29(625)-29(636):ASSIGNMENT:board = null
<A NAME="token18">18:</A>30(645)-30(675):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token19">19:</A>31(682)-31(682):BLOCK_END:}
<A NAME="token20">20:</A>31(682)-31(682):IF_END:}
<A NAME="token21">21:</A>34(717)-34(738):IF:if (app=="/startgame")
<A NAME="token22">22:</A>34(740)-34(740):BLOCK:{
<A NAME="token23">23:</A>35(748)-36(879):IF:if (ctx.formParam("type").isBlank() || (ctx.formParam("type").charAt(0) != 'X'
<A NAME="token24">24:</A>35(752)-35(772):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token25">25:</A>35(752)-35(782):METHOD_INVOCATION:ctx.formParam("type").isBlank()
<A NAME="token26">26:</A>35(788)-35(808):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token27">27:</A>35(788)-35(818):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token28">28:</A>36(840)-36(860):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token29">29:</A>36(840)-36(870):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token30">30:</A>36(881)-36(881):BLOCK:{
<A NAME="token31">31:</A>37(891)-37(905):METHOD_INVOCATION:ctx.status(500)
<A NAME="token32">32:</A>37(891)-37(928):METHOD_INVOCATION:ctx.status(500).result("Invalid type")
<A NAME="token33">33:</A>38(939)-38(945):RETURN:return;
<A NAME="token34">34:</A>39(953)-39(953):BLOCK_END:}
<A NAME="token35">35:</A>39(953)-39(953):IF_END:}
<A NAME="token36">36:</A>42(1035)-42(1072):VARIABLE_DECLARATION:type = ctx.formParam("type").charAt(0)
<A NAME="token37">37:</A>42(1042)-42(1062):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token38">38:</A>42(1042)-42(1072):METHOD_INVOCATION:ctx.formParam("type").charAt(0)
<A NAME="token39">39:</A>43(1081)-43(1107):ASSIGNMENT:board = new GameBoard(type)
<A NAME="token40">40:</A>43(1089)-43(1107):NEW:new GameBoard(type)
<A NAME="token41">41:</A>45(1117)-45(1131):METHOD_INVOCATION:ctx.status(200)
<A NAME="token42">42:</A>45(1117)-45(1154):METHOD_INVOCATION:ctx.status(200).result(board.toJson())
<A NAME="token43">43:</A>45(1140)-45(1153):METHOD_INVOCATION:board.toJson()
<A NAME="token44">44:</A>46(1161)-46(1161):BLOCK_END:}
<A NAME="token45">45:</A>46(1161)-46(1161):IF_END:}
<A NAME="token46">46:</A>49(1201)-49(1221):IF:if (app=="/joingame")
<A NAME="token47">47:</A>49(1223)-49(1223):BLOCK:{
<A NAME="token48">48:</A>50(1231)-50(1248):IF:if (board == null)
<A NAME="token49">49:</A>50(1250)-50(1250):BLOCK:{
<A NAME="token50">50:</A>51(1260)-51(1274):METHOD_INVOCATION:ctx.status(500)
<A NAME="token51">51:</A>51(1260)-51(1306):METHOD_INVOCATION:ctx.status(500).result("Board not initialized")
<A NAME="token52">52:</A>52(1317)-52(1323):RETURN:return;
<A NAME="token53">53:</A>53(1331)-53(1331):BLOCK_END:}
<A NAME="token54">54:</A>53(1331)-53(1331):IF_END:}
<A NAME="token55">55:</A>56(1371)-56(1375):TRY:try {
<A NAME="token56">56:</A>57(1385)-57(1400):METHOD_INVOCATION:board.joinGame()
<A NAME="token57">57:</A>58(1409)-58(1409):TRY_END:}
<A NAME="token58">58:</A>58(1411)-58(1431):CATCH:catch (Exception e) {
<A NAME="token59">59:</A>59(1441)-59(1455):METHOD_INVOCATION:ctx.status(400)
<A NAME="token60">60:</A>59(1441)-59(1478):METHOD_INVOCATION:ctx.status(400).result(e.getMessage())
<A NAME="token61">61:</A>59(1464)-59(1477):METHOD_INVOCATION:e.getMessage()
<A NAME="token62">62:</A>60(1489)-60(1495):RETURN:return;
<A NAME="token63">63:</A>61(1503)-61(1503):CATCH_END:}
<A NAME="token64">64:</A>63(1518)-63(1532):METHOD_INVOCATION:ctx.status(302)
<A NAME="token65">65:</A>63(1518)-63(1564):METHOD_INVOCATION:ctx.status(302).redirect("/tictactoe.html?p=2")
<A NAME="token66">66:</A>65(1638)-65(1681):METHOD_INVOCATION:sendGameBoardToAllPlayers(board.toJson(), 1)
<A NAME="token67">67:</A>65(1664)-65(1677):METHOD_INVOCATION:board.toJson()
<A NAME="token68">68:</A>66(1688)-66(1688):BLOCK_END:}
<A NAME="token69">69:</A>66(1688)-66(1688):IF_END:}
<A NAME="token70">70:</A>69(1741)-69(1766):IF:if(app=="/move/:playerId")
<A NAME="token71">71:</A>69(1768)-69(1768):BLOCK:{
<A NAME="token72">72:</A>71(1821)-71(1864):IF:if (board == null || !board.isGameStarted())
<A NAME="token73">73:</A>71(1843)-71(1863):METHOD_INVOCATION:board.isGameStarted()
<A NAME="token74">74:</A>71(1866)-71(1866):BLOCK:{
<A NAME="token75">75:</A>72(1876)-72(1890):METHOD_INVOCATION:ctx.status(400)
<A NAME="token76">76:</A>72(1876)-72(1917):METHOD_INVOCATION:ctx.status(400).result("Game not started")
<A NAME="token77">77:</A>73(1928)-73(1934):RETURN:return;
<A NAME="token78">78:</A>74(1942)-74(1942):BLOCK_END:}
<A NAME="token79">79:</A>74(1942)-74(1942):IF_END:}
<A NAME="token80">80:</A>77(1997)-77(2019):IF:if (board.isGameOver())
<A NAME="token81">81:</A>77(2001)-77(2018):METHOD_INVOCATION:board.isGameOver()
<A NAME="token82">82:</A>77(2021)-77(2021):BLOCK:{
<A NAME="token83">83:</A>78(2031)-78(2045):METHOD_INVOCATION:ctx.status(200)
<A NAME="token84">84:</A>78(2031)-78(2107):METHOD_INVOCATION:ctx.status(200).result(new Message(false, 101, "Game already over").toJson())
<A NAME="token85">85:</A>78(2054)-78(2097):NEW:new Message(false, 101, "Game already over")
<A NAME="token86">86:</A>78(2054)-78(2106):METHOD_INVOCATION:new Message(false, 101, "Game already over").toJson()
<A NAME="token87">87:</A>79(2118)-79(2124):RETURN:return;
<A NAME="token88">88:</A>80(2132)-80(2132):BLOCK_END:}
<A NAME="token89">89:</A>80(2132)-80(2132):IF_END:}
<A NAME="token90">90:</A>83(2187)-83(2230):IF:if (ctx.pathParam("playerId").length() != 1)
<A NAME="token91">91:</A>83(2191)-83(2215):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token92">92:</A>83(2191)-83(2224):METHOD_INVOCATION:ctx.pathParam("playerId").length()
<A NAME="token93">93:</A>83(2232)-83(2232):BLOCK:{
<A NAME="token94">94:</A>84(2242)-84(2256):METHOD_INVOCATION:ctx.status(200)
<A NAME="token95">95:</A>84(2242)-84(2317):METHOD_INVOCATION:ctx.status(200).result(new Message(false, 102, "Invalid playerId").toJson())
<A NAME="token96">96:</A>84(2265)-84(2307):NEW:new Message(false, 102, "Invalid playerId")
<A NAME="token97">97:</A>84(2265)-84(2316):METHOD_INVOCATION:new Message(false, 102, "Invalid playerId").toJson()
<A NAME="token98">98:</A>85(2328)-85(2334):RETURN:return;
<A NAME="token99">99:</A>86(2342)-86(2342):BLOCK_END:}
<A NAME="token100">100:</A>86(2342)-86(2342):IF_END:}
<A NAME="token101">101:</A>89(2406)-89(2459):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token102">102:</A>89(2417)-89(2459):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token103">103:</A>89(2434)-89(2458):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token104">104:</A>90(2468)-90(2502):IF:if (playerId != 1 &amp;&amp; playerId != 2)
<A NAME="token105">105:</A>90(2504)-90(2504):BLOCK:{
<A NAME="token106">106:</A>91(2514)-91(2528):METHOD_INVOCATION:ctx.status(200)
<A NAME="token107">107:</A>91(2514)-91(2591):METHOD_INVOCATION:ctx.status(200).result(new Message(false, 103, "Incorrect playerId").toJson())
<A NAME="token108">108:</A>91(2537)-91(2581):NEW:new Message(false, 103, "Incorrect playerId")
<A NAME="token109">109:</A>91(2537)-91(2590):METHOD_INVOCATION:new Message(false, 103, "Incorrect playerId").toJson()
<A NAME="token110">110:</A>92(2602)-92(2608):RETURN:return;
<A NAME="token111">111:</A>93(2616)-93(2616):BLOCK_END:}
<A NAME="token112">112:</A>93(2616)-93(2616):IF_END:}
<A NAME="token113">113:</A>96(2668)-96(2732):IF:if (ctx.formParam("x").isBlank() || ctx.formParam("y").isBlank())
<A NAME="token114">114:</A>96(2672)-96(2689):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token115">115:</A>96(2672)-96(2699):METHOD_INVOCATION:ctx.formParam("x").isBlank()
<A NAME="token116">116:</A>96(2704)-96(2721):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token117">117:</A>96(2704)-96(2731):METHOD_INVOCATION:ctx.formParam("y").isBlank()
<A NAME="token118">118:</A>96(2734)-96(2734):BLOCK:{
<A NAME="token119">119:</A>97(2744)-97(2758):METHOD_INVOCATION:ctx.status(200)
<A NAME="token120">120:</A>97(2744)-97(2819):METHOD_INVOCATION:ctx.status(200).result(new Message(false, 104, "Missing position").toJson())
<A NAME="token121">121:</A>97(2767)-97(2809):NEW:new Message(false, 104, "Missing position")
<A NAME="token122">122:</A>97(2767)-97(2818):METHOD_INVOCATION:new Message(false, 104, "Missing position").toJson()
<A NAME="token123">123:</A>98(2830)-98(2836):RETURN:return;
<A NAME="token124">124:</A>99(2844)-99(2844):BLOCK_END:}
<A NAME="token125">125:</A>99(2844)-99(2844):IF_END:}
<A NAME="token126">126:</A>102(2930)-102(2983):VARIABLE_DECLARATION:player = playerId == 1 ? board.getP1() : board.getP2()
<A NAME="token127">127:</A>102(2955)-102(2967):METHOD_INVOCATION:board.getP1()
<A NAME="token128">128:</A>102(2971)-102(2983):METHOD_INVOCATION:board.getP2()
<A NAME="token129">129:</A>103(3002)-103(3041):VARIABLE_DECLARATION:x = Integer.parseInt(ctx.formParam("x"))
<A NAME="token130">130:</A>103(3006)-103(3041):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token131">131:</A>103(3023)-103(3040):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token132">132:</A>104(3060)-104(3099):VARIABLE_DECLARATION:y = Integer.parseInt(ctx.formParam("y"))
<A NAME="token133">133:</A>104(3064)-104(3099):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token134">134:</A>104(3081)-104(3098):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token135">135:</A>107(3189)-107(3193):TRY:try {
<A NAME="token136">136:</A>108(3203)-108(3230):METHOD_INVOCATION:board.playTurn(player, x, y)
<A NAME="token137">137:</A>109(3239)-109(3239):TRY_END:}
<A NAME="token138">138:</A>109(3241)-109(3261):CATCH:catch (Exception e) {
<A NAME="token139">139:</A>110(3271)-110(3285):METHOD_INVOCATION:ctx.status(200)
<A NAME="token140">140:</A>110(3271)-110(3342):METHOD_INVOCATION:ctx.status(200).result(new Message(false, 105, e.getMessage()).toJson())
<A NAME="token141">141:</A>110(3294)-110(3332):NEW:new Message(false, 105, e.getMessage())
<A NAME="token142">142:</A>110(3294)-110(3341):METHOD_INVOCATION:new Message(false, 105, e.getMessage()).toJson()
<A NAME="token143">143:</A>110(3318)-110(3331):METHOD_INVOCATION:e.getMessage()
<A NAME="token144">144:</A>111(3353)-111(3359):RETURN:return;
<A NAME="token145">145:</A>112(3367)-112(3367):CATCH_END:}
<A NAME="token146">146:</A>114(3382)-114(3396):METHOD_INVOCATION:ctx.status(200)
<A NAME="token147">147:</A>114(3382)-114(3440):METHOD_INVOCATION:ctx.status(200).result(new Message(true, 100, "").toJson())
<A NAME="token148">148:</A>114(3405)-114(3430):NEW:new Message(true, 100, "")
<A NAME="token149">149:</A>114(3405)-114(3439):METHOD_INVOCATION:new Message(true, 100, "").toJson()
<A NAME="token150">150:</A>115(3449)-115(3489):METHOD_INVOCATION:sendGameBoardToAllPlayers(board.toJson())
<A NAME="token151">151:</A>115(3475)-115(3488):METHOD_INVOCATION:board.toJson()
<A NAME="token152">152:</A>116(3496)-116(3496):BLOCK_END:}
<A NAME="token153">153:</A>116(3496)-116(3496):IF_END:}
<A NAME="token154">154:</A>119(3548)-119(3586):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token155">155:</A>119(3569)-119(3585):NEW:new UiWebSocket()
<A NAME="token156">156:</A>120(3591)-120(3591):METHOD_DECLARATION_END:}
<A NAME="token157">157:</A>128(3765)-128(3819):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token158">158:</A>129(3840)-129(3875):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token159">159:</A>129(3851)-129(3875):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token160">160:</A>130(3882)-130(3919):FOR:for (Session sessionPlayer : sessions)
<A NAME="token161">161:</A>130(3921)-130(3921):BLOCK:{
<A NAME="token162">162:</A>131(3929)-131(3933):TRY:try {
<A NAME="token163">163:</A>132(3943)-132(3967):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token164">164:</A>132(3943)-132(3993):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token165">165:</A>133(4002)-133(4002):TRY_END:}
<A NAME="token166">166:</A>133(4004)-133(4026):CATCH:catch (IOException e) {
<A NAME="token167">167:</A>134(4036)-134(4054):METHOD_INVOCATION:e.printStackTrace()
<A NAME="token168">168:</A>135(4063)-135(4063):CATCH_END:}
<A NAME="token169">169:</A>136(4069)-136(4069):BLOCK_END:}
<A NAME="token170">170:</A>136(4069)-136(4069):FOR_END:}
<A NAME="token171">171:</A>137(4073)-137(4073):METHOD_DECLARATION_END:}
<A NAME="token172">172:</A>139(4097)-139(4104):METHOD_DECLARATION:stop() {
<A NAME="token173">173:</A>140(4110)-140(4119):METHOD_INVOCATION:app.stop()
<A NAME="token174">174:</A>141(4124)-141(4124):METHOD_DECLARATION_END:}
<A NAME="token175">175:</A>142(4126)-142(4126):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
