<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(153):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token6">6:</A>8(155)-8(176):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(178)-9(196):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(198)-10(218):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(220)-11(260):IMPORT_DECLARATION:import models.error.InvalidMoveException;
<A NAME="token10">10:</A>12(262)-12(308):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token11">11:</A>12(308)-14(326):CLASS_DECLARATION:;
<A NAME="token12">12:</A>16(356)-16(373):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token13">13:</A>18(402)-18(404):VARIABLE_DECLARATION:app
<A NAME="token14">14:</A>23(513)-23(539):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token15">15:</A>24(556)-24(572):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token16">16:</A>24(563)-24(572):NEW:new Gson()
<A NAME="token17">17:</A>25(595)-25(617):VARIABLE_DECLARATION:board = new GameBoard()
<A NAME="token18">18:</A>25(603)-25(617):NEW:new GameBoard()
<A NAME="token19">19:</A>30(651)-30(667):IF:if (app=="/echo")
<A NAME="token20">20:</A>30(669)-30(669):BLOCK:{
<A NAME="token21">21:</A>31(677)-31(698):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token22">22:</A>31(688)-31(697):METHOD_INVOCATION:ctx.body()
<A NAME="token23">23:</A>32(705)-32(705):BLOCK_END:}
<A NAME="token24">24:</A>32(705)-32(705):IF_END:}
<A NAME="token25">25:</A>34(712)-34(731):IF:if (app=="/newgame")
<A NAME="token26">26:</A>34(733)-34(733):BLOCK:{
<A NAME="token27">27:</A>35(741)-35(755):METHOD_INVOCATION:board.newGame()
<A NAME="token28">28:</A>36(764)-36(794):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token29">29:</A>37(801)-37(801):BLOCK_END:}
<A NAME="token30">30:</A>37(801)-37(801):IF_END:}
<A NAME="token31">31:</A>39(808)-39(829):IF:if (app=="/startgame")
<A NAME="token32">32:</A>39(831)-39(831):BLOCK:{
<A NAME="token33">33:</A>40(846)-40(873):VARIABLE_DECLARATION:type = ctx.formParam("type")
<A NAME="token34">34:</A>40(853)-40(873):METHOD_INVOCATION:ctx.formParam("type")
<A NAME="token35">35:</A>41(887)-41(887):VARIABLE_DECLARATION:c
<A NAME="token36">36:</A>42(896)-42(916):IF:if (type.equals("X"))
<A NAME="token37">37:</A>42(900)-42(915):METHOD_INVOCATION:type.equals("X")
<A NAME="token38">38:</A>42(918)-42(918):BLOCK:{
<A NAME="token39">39:</A>43(928)-43(934):ASSIGNMENT:c = 'X'
<A NAME="token40">40:</A>44(943)-44(943):BLOCK_END:}
<A NAME="token41">41:</A>44(943)-44(943):IF_END:}
<A NAME="token42">42:</A>44(945)-44(948):ELSE:else
<A NAME="token43">43:</A>44(950)-44(970):IF:if (type.equals("O"))
<A NAME="token44">44:</A>44(954)-44(969):METHOD_INVOCATION:type.equals("O")
<A NAME="token45">45:</A>44(972)-44(972):BLOCK:{
<A NAME="token46">46:</A>45(982)-45(988):ASSIGNMENT:c = 'O'
<A NAME="token47">47:</A>46(997)-46(997):BLOCK_END:}
<A NAME="token48">48:</A>46(997)-46(997):IF_END:}
<A NAME="token49">49:</A>46(999)-46(1002):ELSE:else
<A NAME="token50">50:</A>46(1004)-46(1004):BLOCK:{
<A NAME="token51">51:</A>47(1014)-47(1028):METHOD_INVOCATION:ctx.status(400)
<A NAME="token52">52:</A>48(1039)-48(1045):RETURN:return;
<A NAME="token53">53:</A>49(1053)-49(1053):BLOCK_END:}
<A NAME="token54">54:</A>49(1053)-49(1053):ELSE_END:}
<A NAME="token55">55:</A>51(1062)-51(1095):METHOD_INVOCATION:board.setPlayer1(new Player(c, 1))
<A NAME="token56">56:</A>51(1079)-51(1094):NEW:new Player(c, 1)
<A NAME="token57">57:</A>52(1104)-52(1133):METHOD_INVOCATION:ctx.result(gson.toJson(board))
<A NAME="token58">58:</A>52(1115)-52(1132):METHOD_INVOCATION:gson.toJson(board)
<A NAME="token59">59:</A>53(1140)-53(1140):BLOCK_END:}
<A NAME="token60">60:</A>53(1140)-53(1140):IF_END:}
<A NAME="token61">61:</A>55(1147)-55(1167):IF:if (app=="/joingame")
<A NAME="token62">62:</A>55(1169)-55(1169):BLOCK:{
<A NAME="token63">63:</A>56(1184)-56(1211):VARIABLE_DECLARATION:player1 = board.getPlayer1()
<A NAME="token64">64:</A>56(1194)-56(1211):METHOD_INVOCATION:board.getPlayer1()
<A NAME="token65">65:</A>57(1220)-57(1239):IF:if (player1 == null)
<A NAME="token66">66:</A>57(1241)-57(1241):BLOCK:{
<A NAME="token67">67:</A>58(1251)-58(1287):METHOD_INVOCATION:ctx.result("Player 1 not joined yet")
<A NAME="token68">68:</A>59(1298)-59(1304):RETURN:return;
<A NAME="token69">69:</A>60(1312)-60(1312):BLOCK_END:}
<A NAME="token70">70:</A>60(1312)-60(1312):IF_END:}
<A NAME="token71">71:</A>62(1326)-62(1326):VARIABLE_DECLARATION:c
<A NAME="token72">72:</A>63(1335)-63(1363):IF:if (player1.getType() == 'X')
<A NAME="token73">73:</A>63(1339)-63(1355):METHOD_INVOCATION:player1.getType()
<A NAME="token74">74:</A>63(1365)-63(1365):BLOCK:{
<A NAME="token75">75:</A>64(1375)-64(1381):ASSIGNMENT:c = 'O'
<A NAME="token76">76:</A>65(1390)-65(1390):BLOCK_END:}
<A NAME="token77">77:</A>65(1390)-65(1390):IF_END:}
<A NAME="token78">78:</A>65(1392)-65(1395):ELSE:else
<A NAME="token79">79:</A>65(1397)-65(1397):BLOCK:{
<A NAME="token80">80:</A>66(1407)-66(1413):ASSIGNMENT:c = 'X'
<A NAME="token81">81:</A>67(1422)-67(1422):BLOCK_END:}
<A NAME="token82">82:</A>67(1422)-67(1422):ELSE_END:}
<A NAME="token83">83:</A>69(1437)-69(1470):METHOD_INVOCATION:board.setPlayer2(new Player(c, 2))
<A NAME="token84">84:</A>69(1454)-69(1469):NEW:new Player(c, 2)
<A NAME="token85">85:</A>70(1479)-70(1495):METHOD_INVOCATION:board.startGame()
<A NAME="token86">86:</A>72(1505)-72(1539):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token87">87:</A>74(1549)-74(1593):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(board))
<A NAME="token88">88:</A>74(1575)-74(1592):METHOD_INVOCATION:gson.toJson(board)
<A NAME="token89">89:</A>75(1600)-75(1600):BLOCK_END:}
<A NAME="token90">90:</A>75(1600)-75(1600):IF_END:}
<A NAME="token91">91:</A>77(1611)-77(1637):IF:if (app=="/move/:playerId")
<A NAME="token92">92:</A>77(1639)-77(1639):BLOCK:{
<A NAME="token93">93:</A>78(1651)-78(1704):VARIABLE_DECLARATION:playerId = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token94">94:</A>78(1662)-78(1704):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token95">95:</A>78(1679)-78(1703):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token96">96:</A>79(1717)-79(1756):VARIABLE_DECLARATION:x = Integer.parseInt(ctx.formParam("x"))
<A NAME="token97">97:</A>79(1721)-79(1756):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("x"))
<A NAME="token98">98:</A>79(1738)-79(1755):METHOD_INVOCATION:ctx.formParam("x")
<A NAME="token99">99:</A>80(1769)-80(1808):VARIABLE_DECLARATION:y = Integer.parseInt(ctx.formParam("y"))
<A NAME="token100">100:</A>80(1773)-80(1808):METHOD_INVOCATION:Integer.parseInt(ctx.formParam("y"))
<A NAME="token101">101:</A>80(1790)-80(1807):METHOD_INVOCATION:ctx.formParam("y")
<A NAME="token102">102:</A>82(1825)-82(1837):VARIABLE_DECLARATION:player = null
<A NAME="token103">103:</A>83(1846)-83(1888):IF:if (playerId == board.getPlayer1().getId())
<A NAME="token104">104:</A>83(1862)-83(1879):METHOD_INVOCATION:board.getPlayer1()
<A NAME="token105">105:</A>83(1862)-83(1887):METHOD_INVOCATION:board.getPlayer1().getId()
<A NAME="token106">106:</A>83(1890)-83(1890):BLOCK:{
<A NAME="token107">107:</A>84(1900)-84(1926):ASSIGNMENT:player = board.getPlayer1()
<A NAME="token108">108:</A>84(1909)-84(1926):METHOD_INVOCATION:board.getPlayer1()
<A NAME="token109">109:</A>85(1935)-85(1935):BLOCK_END:}
<A NAME="token110">110:</A>85(1935)-85(1935):IF_END:}
<A NAME="token111">111:</A>85(1937)-85(1940):ELSE:else
<A NAME="token112">112:</A>85(1942)-85(1984):IF:if (playerId == board.getPlayer2().getId())
<A NAME="token113">113:</A>85(1958)-85(1975):METHOD_INVOCATION:board.getPlayer2()
<A NAME="token114">114:</A>85(1958)-85(1983):METHOD_INVOCATION:board.getPlayer2().getId()
<A NAME="token115">115:</A>85(1986)-85(1986):BLOCK:{
<A NAME="token116">116:</A>86(1996)-86(2022):ASSIGNMENT:player = board.getPlayer2()
<A NAME="token117">117:</A>86(2005)-86(2022):METHOD_INVOCATION:board.getPlayer2()
<A NAME="token118">118:</A>87(2031)-87(2031):BLOCK_END:}
<A NAME="token119">119:</A>87(2031)-87(2031):IF_END:}
<A NAME="token120">120:</A>87(2033)-87(2036):ELSE:else
<A NAME="token121">121:</A>87(2038)-87(2038):BLOCK:{
<A NAME="token122">122:</A>88(2048)-88(2062):METHOD_INVOCATION:ctx.status(400)
<A NAME="token123">123:</A>89(2073)-89(2103):METHOD_INVOCATION:ctx.result("Invalid player id")
<A NAME="token124">124:</A>90(2114)-90(2120):RETURN:return;
<A NAME="token125">125:</A>91(2128)-91(2128):BLOCK_END:}
<A NAME="token126">126:</A>91(2128)-91(2128):ELSE_END:}
<A NAME="token127">127:</A>93(2143)-93(2147):TRY:try {
<A NAME="token128">128:</A>94(2157)-94(2190):METHOD_INVOCATION:board.move(new Move(player, x, y))
<A NAME="token129">129:</A>94(2168)-94(2189):NEW:new Move(player, x, y)
<A NAME="token130">130:</A>95(2201)-95(2251):METHOD_INVOCATION:ctx.result(gson.toJson(new Message(true, 100, "")))
<A NAME="token131">131:</A>95(2212)-95(2250):METHOD_INVOCATION:gson.toJson(new Message(true, 100, ""))
<A NAME="token132">132:</A>95(2224)-95(2249):NEW:new Message(true, 100, "")
<A NAME="token133">133:</A>96(2260)-96(2260):TRY_END:}
<A NAME="token134">134:</A>96(2262)-96(2293):CATCH:catch (InvalidMoveException e) {
<A NAME="token135">135:</A>97(2303)-97(2366):METHOD_INVOCATION:ctx.result(gson.toJson(new Message(false, e.code(), e.cause())))
<A NAME="token136">136:</A>97(2314)-97(2365):METHOD_INVOCATION:gson.toJson(new Message(false, e.code(), e.cause()))
<A NAME="token137">137:</A>97(2326)-97(2364):NEW:new Message(false, e.code(), e.cause())
<A NAME="token138">138:</A>97(2345)-97(2352):METHOD_INVOCATION:e.code()
<A NAME="token139">139:</A>97(2355)-97(2363):METHOD_INVOCATION:e.cause()
<A NAME="token140">140:</A>98(2375)-98(2375):CATCH_END:}
<A NAME="token141">141:</A>100(2384)-100(2428):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(board))
<A NAME="token142">142:</A>100(2410)-100(2427):METHOD_INVOCATION:gson.toJson(board)
<A NAME="token143">143:</A>101(2435)-101(2435):BLOCK_END:}
<A NAME="token144">144:</A>101(2435)-101(2435):IF_END:}
<A NAME="token145">145:</A>104(2487)-104(2525):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token146">146:</A>104(2508)-104(2524):NEW:new UiWebSocket()
<A NAME="token147">147:</A>105(2530)-105(2530):METHOD_DECLARATION_END:}
<A NAME="token148">148:</A>111(2698)-111(2752):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token149">149:</A>112(2773)-112(2808):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token150">150:</A>112(2784)-112(2808):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token151">151:</A>113(2815)-113(2852):FOR:for (Session sessionPlayer : sessions)
<A NAME="token152">152:</A>113(2854)-113(2854):BLOCK:{
<A NAME="token153">153:</A>114(2862)-114(2866):TRY:try {
<A NAME="token154">154:</A>115(2876)-115(2900):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token155">155:</A>115(2876)-115(2926):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token156">156:</A>116(2935)-116(2935):TRY_END:}
<A NAME="token157">157:</A>116(2937)-116(2959):CATCH:catch (IOException e) {
<A NAME="token158">158:</A>118(2994)-118(2994):CATCH_END:}
<A NAME="token159">159:</A>119(3000)-119(3000):BLOCK_END:}
<A NAME="token160">160:</A>119(3000)-119(3000):FOR_END:}
<A NAME="token161">161:</A>120(3004)-120(3004):METHOD_DECLARATION_END:}
<A NAME="token162">162:</A>122(3028)-122(3035):METHOD_DECLARATION:stop() {
<A NAME="token163">163:</A>123(3041)-123(3050):METHOD_INVOCATION:app.stop()
<A NAME="token164">164:</A>124(3055)-124(3055):METHOD_DECLARATION_END:}
<A NAME="token165">165:</A>125(3057)-125(3057):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
