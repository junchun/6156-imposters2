<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(153):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token6">6:</A>8(155)-8(176):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(178)-9(196):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(198)-10(218):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(220)-11(266):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>11(266)-13(284):CLASS_DECLARATION:;
<A NAME="token11">11:</A>15(314)-15(331):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token12">12:</A>16(356)-16(372):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token13">13:</A>16(363)-16(372):NEW:new Gson()
<A NAME="token14">14:</A>17(400)-17(402):VARIABLE_DECLARATION:app
<A NAME="token15">15:</A>18(432)-18(440):VARIABLE_DECLARATION:gameboard
<A NAME="token16">16:</A>19(467)-19(468):VARIABLE_DECLARATION:p1
<A NAME="token17">17:</A>20(495)-20(496):VARIABLE_DECLARATION:p2
<A NAME="token18">18:</A>25(605)-25(631):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token19">19:</A>29(663)-29(679):IF:if (app=="/echo")
<A NAME="token20">20:</A>29(681)-29(681):BLOCK:{
<A NAME="token21">21:</A>30(689)-30(710):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token22">22:</A>30(700)-30(709):METHOD_INVOCATION:ctx.body()
<A NAME="token23">23:</A>31(717)-31(717):BLOCK_END:}
<A NAME="token24">24:</A>31(717)-31(717):IF_END:}
<A NAME="token25">25:</A>34(752)-34(764):IF:if (app=="/")
<A NAME="token26">26:</A>34(766)-34(766):BLOCK:{
<A NAME="token27">27:</A>35(774)-35(797):METHOD_INVOCATION:ctx.redirect("/newgame")
<A NAME="token28">28:</A>36(804)-36(804):BLOCK_END:}
<A NAME="token29">29:</A>36(804)-36(804):IF_END:}
<A NAME="token30">30:</A>39(839)-39(858):IF:if (app=="/newgame")
<A NAME="token31">31:</A>39(860)-39(860):BLOCK:{
<A NAME="token32">32:</A>40(868)-40(894):ASSIGNMENT:gameboard = new GameBoard()
<A NAME="token33">33:</A>40(880)-40(894):NEW:new GameBoard()
<A NAME="token34">34:</A>41(903)-41(933):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token35">35:</A>42(940)-42(940):BLOCK_END:}
<A NAME="token36">36:</A>42(940)-42(940):IF_END:}
<A NAME="token37">37:</A>45(983)-45(1004):IF:if (app=="/startgame")
<A NAME="token38">38:</A>45(1006)-45(1006):BLOCK:{
<A NAME="token39">39:</A>46(1021)-46(1036):VARIABLE_DECLARATION:str = ctx.body()
<A NAME="token40">40:</A>46(1027)-46(1036):METHOD_INVOCATION:ctx.body()
<A NAME="token41">41:</A>47(1050)-47(1084):VARIABLE_DECLARATION:type = str.charAt(str.length() - 1)
<A NAME="token42">42:</A>47(1057)-47(1084):METHOD_INVOCATION:str.charAt(str.length() - 1)
<A NAME="token43">43:</A>47(1068)-47(1079):METHOD_INVOCATION:str.length()
<A NAME="token44">44:</A>48(1093)-48(1116):ASSIGNMENT:p1 = new Player(type, 1)
<A NAME="token45">45:</A>48(1098)-48(1116):NEW:new Player(type, 1)
<A NAME="token46">46:</A>50(1132)-50(1155):METHOD_INVOCATION:gameboard.setPlayer1(p1)
<A NAME="token47">47:</A>51(1164)-51(1178):METHOD_INVOCATION:ctx.status(201)
<A NAME="token48">48:</A>52(1198)-52(1231):METHOD_INVOCATION:ctx.result(gson.toJson(gameboard))
<A NAME="token49">49:</A>52(1209)-52(1230):METHOD_INVOCATION:gson.toJson(gameboard)
<A NAME="token50">50:</A>53(1238)-53(1238):BLOCK_END:}
<A NAME="token51">51:</A>53(1238)-53(1238):IF_END:}
<A NAME="token52">52:</A>56(1280)-56(1300):IF:if (app=="/joingame")
<A NAME="token53">53:</A>56(1302)-56(1302):BLOCK:{
<A NAME="token54">54:</A>57(1315)-57(1324):VARIABLE_DECLARATION:type = 'O'
<A NAME="token55">55:</A>58(1333)-58(1356):IF:if (p1.getType() == 'O')
<A NAME="token56">56:</A>58(1337)-58(1348):METHOD_INVOCATION:p1.getType()
<A NAME="token57">57:</A>58(1358)-58(1358):BLOCK:{
<A NAME="token58">58:</A>59(1368)-59(1377):ASSIGNMENT:type = 'X'
<A NAME="token59">59:</A>60(1386)-60(1386):BLOCK_END:}
<A NAME="token60">60:</A>60(1386)-60(1386):IF_END:}
<A NAME="token61">61:</A>61(1394)-61(1417):ASSIGNMENT:p2 = new Player(type, 2)
<A NAME="token62">62:</A>61(1399)-61(1417):NEW:new Player(type, 2)
<A NAME="token63">63:</A>62(1426)-62(1449):METHOD_INVOCATION:gameboard.setPlayer2(p2)
<A NAME="token64">64:</A>63(1458)-63(1472):METHOD_INVOCATION:ctx.status(302)
<A NAME="token65">65:</A>64(1495)-64(1529):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token66">66:</A>65(1538)-65(1586):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameboard))
<A NAME="token67">67:</A>65(1564)-65(1585):METHOD_INVOCATION:gson.toJson(gameboard)
<A NAME="token68">68:</A>66(1593)-66(1593):BLOCK_END:}
<A NAME="token69">69:</A>66(1593)-66(1593):IF_END:}
<A NAME="token70">70:</A>69(1620)-69(1646):IF:if (app=="/move/:playerId")
<A NAME="token71">71:</A>69(1648)-69(1648):BLOCK:{
<A NAME="token72">72:</A>70(1660)-70(1707):VARIABLE_DECLARATION:id = Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token73">73:</A>70(1665)-70(1707):METHOD_INVOCATION:Integer.parseInt(ctx.pathParam("playerId"))
<A NAME="token74">74:</A>70(1682)-70(1706):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token75">75:</A>71(1723)-71(1738):VARIABLE_DECLARATION:str = ctx.body()
<A NAME="token76">76:</A>71(1729)-71(1738):METHOD_INVOCATION:ctx.body()
<A NAME="token77">77:</A>72(1751)-72(1794):VARIABLE_DECLARATION:x = Character.getNumericValue(str.charAt(2))
<A NAME="token78">78:</A>72(1755)-72(1794):METHOD_INVOCATION:Character.getNumericValue(str.charAt(2))
<A NAME="token79">79:</A>72(1781)-72(1793):METHOD_INVOCATION:str.charAt(2)
<A NAME="token80">80:</A>73(1807)-73(1850):VARIABLE_DECLARATION:y = Character.getNumericValue(str.charAt(6))
<A NAME="token81">81:</A>73(1811)-73(1850):METHOD_INVOCATION:Character.getNumericValue(str.charAt(6))
<A NAME="token82">82:</A>73(1837)-73(1849):METHOD_INVOCATION:str.charAt(6)
<A NAME="token83">83:</A>74(1864)-74(1867):VARIABLE_DECLARATION:move
<A NAME="token84">84:</A>75(1876)-75(1887):IF:if (id == 1)
<A NAME="token85">85:</A>75(1889)-75(1889):BLOCK:{
<A NAME="token86">86:</A>76(1899)-76(1923):ASSIGNMENT:move = new Move(p1, x, y)
<A NAME="token87">87:</A>76(1906)-76(1923):NEW:new Move(p1, x, y)
<A NAME="token88">88:</A>77(1932)-77(1932):BLOCK_END:}
<A NAME="token89">89:</A>77(1932)-77(1932):IF_END:}
<A NAME="token90">90:</A>77(1934)-77(1937):ELSE:else
<A NAME="token91">91:</A>77(1939)-77(1939):BLOCK:{
<A NAME="token92">92:</A>78(1949)-78(1973):ASSIGNMENT:move = new Move(p2, x, y)
<A NAME="token93">93:</A>78(1956)-78(1973):NEW:new Move(p2, x, y)
<A NAME="token94">94:</A>79(1982)-79(1982):BLOCK_END:}
<A NAME="token95">95:</A>79(1982)-79(1982):ELSE_END:}
<A NAME="token96">96:</A>80(1997)-80(2031):VARIABLE_DECLARATION:message = gameboard.validMove(move)
<A NAME="token97">97:</A>80(2007)-80(2031):METHOD_INVOCATION:gameboard.validMove(move)
<A NAME="token98">98:</A>81(2040)-81(2066):METHOD_INVOCATION:System.out.println(message)
<A NAME="token99">99:</A>82(2075)-82(2092):IF:if (message != "")
<A NAME="token100">100:</A>82(2094)-82(2094):BLOCK:{
<A NAME="token101">101:</A>83(2112)-83(2149):VARIABLE_DECLARATION:mes = new Message(false, 100, message)
<A NAME="token102">102:</A>83(2118)-83(2149):NEW:new Message(false, 100, message)
<A NAME="token103">103:</A>84(2160)-84(2187):METHOD_INVOCATION:ctx.result(gson.toJson(mes))
<A NAME="token104">104:</A>84(2171)-84(2186):METHOD_INVOCATION:gson.toJson(mes)
<A NAME="token105">105:</A>85(2196)-85(2196):BLOCK_END:}
<A NAME="token106">106:</A>85(2196)-85(2196):IF_END:}
<A NAME="token107">107:</A>85(2198)-85(2201):ELSE:else
<A NAME="token108">108:</A>85(2203)-85(2203):BLOCK:{
<A NAME="token109">109:</A>87(2238)-87(2265):METHOD_INVOCATION:gameboard.makeMovement(move)
<A NAME="token110">110:</A>88(2284)-88(2315):VARIABLE_DECLARATION:mes = new Message(true, 100, "")
<A NAME="token111">111:</A>88(2290)-88(2315):NEW:new Message(true, 100, "")
<A NAME="token112">112:</A>89(2326)-89(2353):METHOD_INVOCATION:ctx.result(gson.toJson(mes))
<A NAME="token113">113:</A>89(2337)-89(2352):METHOD_INVOCATION:gson.toJson(mes)
<A NAME="token114">114:</A>90(2362)-90(2362):BLOCK_END:}
<A NAME="token115">115:</A>90(2362)-90(2362):ELSE_END:}
<A NAME="token116">116:</A>91(2370)-91(2398):METHOD_INVOCATION:System.out.println(gameboard)
<A NAME="token117">117:</A>92(2407)-92(2455):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameboard))
<A NAME="token118">118:</A>92(2433)-92(2454):METHOD_INVOCATION:gson.toJson(gameboard)
<A NAME="token119">119:</A>93(2462)-93(2462):BLOCK_END:}
<A NAME="token120">120:</A>93(2462)-93(2462):IF_END:}
<A NAME="token121">121:</A>96(2514)-96(2552):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token122">122:</A>96(2535)-96(2551):NEW:new UiWebSocket()
<A NAME="token123">123:</A>97(2557)-97(2557):METHOD_DECLARATION_END:}
<A NAME="token124">124:</A>103(2725)-103(2779):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token125">125:</A>104(2800)-104(2835):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token126">126:</A>104(2811)-104(2835):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token127">127:</A>105(2842)-105(2879):FOR:for (Session sessionPlayer : sessions)
<A NAME="token128">128:</A>105(2881)-105(2881):BLOCK:{
<A NAME="token129">129:</A>106(2889)-106(2893):TRY:try {
<A NAME="token130">130:</A>107(2903)-107(2927):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token131">131:</A>107(2903)-107(2953):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token132">132:</A>108(2962)-108(2962):TRY_END:}
<A NAME="token133">133:</A>108(2964)-108(2986):CATCH:catch (IOException e) {
<A NAME="token134">134:</A>110(3021)-110(3021):CATCH_END:}
<A NAME="token135">135:</A>111(3027)-111(3027):BLOCK_END:}
<A NAME="token136">136:</A>111(3027)-111(3027):FOR_END:}
<A NAME="token137">137:</A>112(3031)-112(3031):METHOD_DECLARATION_END:}
<A NAME="token138">138:</A>114(3055)-114(3062):METHOD_DECLARATION:stop() {
<A NAME="token139">139:</A>115(3068)-115(3077):METHOD_INVOCATION:app.stop()
<A NAME="token140">140:</A>116(3082)-116(3082):METHOD_DECLARATION_END:}
<A NAME="token141">141:</A>117(3084)-117(3084):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
