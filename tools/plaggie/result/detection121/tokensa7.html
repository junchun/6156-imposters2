<HTML>
<HEAD></HEAD>
<BODY>
<CODE><PRE>
<A NAME="token0">0:</A>1(0)-1(19):PACKAGE_DECLARATION:package controllers;
<A NAME="token1">1:</A>3(22)-3(49):IMPORT_DECLARATION:import com.google.gson.Gson;
<A NAME="token2">2:</A>4(51)-4(76):IMPORT_DECLARATION:import io.javalin.Javalin;
<A NAME="token3">3:</A>5(78)-5(104):IMPORT_DECLARATION:import java.io.IOException;
<A NAME="token4">4:</A>6(106)-6(128):IMPORT_DECLARATION:import java.util.Queue;
<A NAME="token5">5:</A>7(130)-7(153):IMPORT_DECLARATION:import models.GameBoard;
<A NAME="token6">6:</A>8(155)-8(176):IMPORT_DECLARATION:import models.Message;
<A NAME="token7">7:</A>9(178)-9(196):IMPORT_DECLARATION:import models.Move;
<A NAME="token8">8:</A>10(198)-10(218):IMPORT_DECLARATION:import models.Player;
<A NAME="token9">9:</A>11(220)-11(266):IMPORT_DECLARATION:import org.eclipse.jetty.websocket.api.Session;
<A NAME="token10">10:</A>12(268)-12(291):IMPORT_DECLARATION:import org.slf4j.Logger;
<A NAME="token11">11:</A>13(293)-13(323):IMPORT_DECLARATION:import org.slf4j.LoggerFactory;
<A NAME="token12">12:</A>13(323)-15(341):CLASS_DECLARATION:;
<A NAME="token13">13:</A>17(371)-17(388):VARIABLE_DECLARATION:PORT_NUMBER = 8080
<A NAME="token14">14:</A>19(417)-19(419):VARIABLE_DECLARATION:app
<A NAME="token15">15:</A>21(452)-21(460):VARIABLE_DECLARATION:gameBoard
<A NAME="token16">16:</A>23(490)-23(496):VARIABLE_DECLARATION:player1
<A NAME="token17">17:</A>25(526)-25(532):VARIABLE_DECLARATION:player2
<A NAME="token18">18:</A>27(562)-27(609):VARIABLE_DECLARATION:logger = LoggerFactory.getLogger(PlayGame.class)
<A NAME="token19">19:</A>27(571)-27(609):METHOD_INVOCATION:LoggerFactory.getLogger(PlayGame.class)
<A NAME="token20">20:</A>33(719)-33(745):METHOD_DECLARATION:main(final String[] args) {
<A NAME="token21">21:</A>37(777)-37(793):IF:if (app=="/echo")
<A NAME="token22">22:</A>37(795)-37(795):BLOCK:{
<A NAME="token23">23:</A>38(803)-38(824):METHOD_INVOCATION:ctx.result(ctx.body())
<A NAME="token24">24:</A>38(814)-38(823):METHOD_INVOCATION:ctx.body()
<A NAME="token25">25:</A>39(831)-39(831):BLOCK_END:}
<A NAME="token26">26:</A>39(831)-39(831):IF_END:}
<A NAME="token27">27:</A>41(842)-41(861):IF:if (app=="/newgame")
<A NAME="token28">28:</A>41(863)-41(863):BLOCK:{
<A NAME="token29">29:</A>42(871)-42(901):METHOD_INVOCATION:ctx.redirect("/tictactoe.html")
<A NAME="token30">30:</A>43(908)-43(908):BLOCK_END:}
<A NAME="token31">31:</A>43(908)-43(908):IF_END:}
<A NAME="token32">32:</A>45(919)-45(940):IF:if (app=="/startgame")
<A NAME="token33">33:</A>45(942)-45(942):BLOCK:{
<A NAME="token34">34:</A>46(957)-46(980):VARIABLE_DECLARATION:requestBody = ctx.body()
<A NAME="token35">35:</A>46(971)-46(980):METHOD_INVOCATION:ctx.body()
<A NAME="token36">36:</A>48(1002)-48(1028):ASSIGNMENT:gameBoard = new GameBoard()
<A NAME="token37">37:</A>48(1014)-48(1028):NEW:new GameBoard()
<A NAME="token38">38:</A>49(1042)-49(1115):VARIABLE_DECLARATION:type = requestBody.charAt(requestBody.indexOf("type=") + "type=".length())
<A NAME="token39">39:</A>49(1049)-49(1115):METHOD_INVOCATION:requestBody.charAt(requestBody.indexOf("type=") + "type=".length())
<A NAME="token40">40:</A>49(1068)-49(1095):METHOD_INVOCATION:requestBody.indexOf("type=")
<A NAME="token41">41:</A>49(1099)-49(1114):METHOD_INVOCATION:"type=".length()
<A NAME="token42">42:</A>50(1124)-50(1145):ASSIGNMENT:player1 = new Player()
<A NAME="token43">43:</A>50(1134)-50(1145):NEW:new Player()
<A NAME="token44">44:</A>51(1154)-51(1169):METHOD_INVOCATION:player1.setId(1)
<A NAME="token45">45:</A>52(1178)-52(1198):METHOD_INVOCATION:player1.setType(type)
<A NAME="token46">46:</A>54(1214)-54(1237):METHOD_INVOCATION:gameBoard.setP1(player1)
<A NAME="token47">47:</A>56(1258)-56(1274):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token48">48:</A>56(1265)-56(1274):NEW:new Gson()
<A NAME="token49">49:</A>57(1283)-57(1316):METHOD_INVOCATION:ctx.result(gson.toJson(gameBoard))
<A NAME="token50">50:</A>57(1294)-57(1315):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token51">51:</A>58(1323)-58(1323):BLOCK_END:}
<A NAME="token52">52:</A>58(1323)-58(1323):IF_END:}
<A NAME="token53">53:</A>60(1334)-60(1354):IF:if (app=="/joingame")
<A NAME="token54">54:</A>60(1356)-60(1356):BLOCK:{
<A NAME="token55">55:</A>61(1364)-61(1398):METHOD_INVOCATION:ctx.redirect("/tictactoe.html?p=2")
<A NAME="token56">56:</A>63(1419)-63(1467):VARIABLE_DECLARATION:playerType = player1.getType() == 'O' ? 'X' : 'O'
<A NAME="token57">57:</A>63(1432)-63(1448):METHOD_INVOCATION:player1.getType()
<A NAME="token58">58:</A>65(1483)-65(1504):ASSIGNMENT:player2 = new Player()
<A NAME="token59">59:</A>65(1493)-65(1504):NEW:new Player()
<A NAME="token60">60:</A>66(1513)-66(1528):METHOD_INVOCATION:player2.setId(2)
<A NAME="token61">61:</A>67(1537)-67(1563):METHOD_INVOCATION:player2.setType(playerType)
<A NAME="token62">62:</A>69(1579)-69(1602):METHOD_INVOCATION:gameBoard.setP2(player2)
<A NAME="token63">63:</A>70(1611)-70(1640):METHOD_INVOCATION:gameBoard.setGameStarted(true)
<A NAME="token64">64:</A>72(1661)-72(1677):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token65">65:</A>72(1668)-72(1677):NEW:new Gson()
<A NAME="token66">66:</A>73(1686)-73(1734):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token67">67:</A>73(1712)-73(1733):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token68">68:</A>74(1741)-74(1741):BLOCK_END:}
<A NAME="token69">69:</A>74(1741)-74(1741):IF_END:}
<A NAME="token70">70:</A>76(1752)-76(1778):IF:if (app=="/move/:playerId")
<A NAME="token71">71:</A>76(1780)-76(1780):BLOCK:{
<A NAME="token72">72:</A>77(1795)-77(1818):VARIABLE_DECLARATION:requestBody = ctx.body()
<A NAME="token73">73:</A>77(1809)-77(1818):METHOD_INVOCATION:ctx.body()
<A NAME="token74">74:</A>78(1834)-78(1869):VARIABLE_DECLARATION:playerId = ctx.pathParam("playerId")
<A NAME="token75">75:</A>78(1845)-78(1869):METHOD_INVOCATION:ctx.pathParam("playerId")
<A NAME="token76">76:</A>79(1885)-79(1890):VARIABLE_DECLARATION:player
<A NAME="token77">77:</A>80(1904)-80(1920):VARIABLE_DECLARATION:move = new Move()
<A NAME="token78">78:</A>80(1911)-80(1920):NEW:new Move()
<A NAME="token79">79:</A>81(1929)-81(1953):IF:if (playerId.equals("1"))
<A NAME="token80">80:</A>81(1933)-81(1952):METHOD_INVOCATION:playerId.equals("1")
<A NAME="token81">81:</A>81(1955)-81(1955):BLOCK:{
<A NAME="token82">82:</A>82(1965)-82(1980):ASSIGNMENT:player = player1
<A NAME="token83">83:</A>83(1989)-83(1989):BLOCK_END:}
<A NAME="token84">84:</A>83(1989)-83(1989):IF_END:}
<A NAME="token85">85:</A>83(1991)-83(1994):ELSE:else
<A NAME="token86">86:</A>83(1996)-83(1996):BLOCK:{
<A NAME="token87">87:</A>84(2006)-84(2021):ASSIGNMENT:player = player2
<A NAME="token88">88:</A>85(2030)-85(2030):BLOCK_END:}
<A NAME="token89">89:</A>85(2030)-85(2030):ELSE_END:}
<A NAME="token90">90:</A>86(2042)-87(2152):VARIABLE_DECLARATION:moveX = Character.getNumericValue(
<A NAME="token91">91:</A>86(2050)-87(2152):METHOD_INVOCATION:Character.getNumericValue(
<A NAME="token92">92:</A>87(2091)-87(2151):METHOD_INVOCATION:requestBody.charAt(requestBody.indexOf("x=") + "x=".length())
<A NAME="token93">93:</A>87(2110)-87(2134):METHOD_INVOCATION:requestBody.indexOf("x=")
<A NAME="token94">94:</A>87(2138)-87(2150):METHOD_INVOCATION:"x=".length()
<A NAME="token95">95:</A>88(2165)-89(2275):VARIABLE_DECLARATION:moveY = Character.getNumericValue(
<A NAME="token96">96:</A>88(2173)-89(2275):METHOD_INVOCATION:Character.getNumericValue(
<A NAME="token97">97:</A>89(2214)-89(2274):METHOD_INVOCATION:requestBody.charAt(requestBody.indexOf("y=") + "y=".length())
<A NAME="token98">98:</A>89(2233)-89(2257):METHOD_INVOCATION:requestBody.indexOf("y=")
<A NAME="token99">99:</A>89(2261)-89(2273):METHOD_INVOCATION:"y=".length()
<A NAME="token100">100:</A>90(2284)-90(2305):METHOD_INVOCATION:move.setPlayer(player)
<A NAME="token101">101:</A>91(2314)-91(2333):METHOD_INVOCATION:move.setMoveX(moveX)
<A NAME="token102">102:</A>92(2342)-92(2361):METHOD_INVOCATION:move.setMoveY(moveY)
<A NAME="token103">103:</A>94(2385)-94(2407):VARIABLE_DECLARATION:message = new Message()
<A NAME="token104">104:</A>94(2395)-94(2407):NEW:new Message()
<A NAME="token105">105:</A>95(2416)-95(2467):METHOD_INVOCATION:message.setMoveValidity(gameBoard.isMoveValid(move))
<A NAME="token106">106:</A>95(2440)-95(2466):METHOD_INVOCATION:gameBoard.isMoveValid(move)
<A NAME="token107">107:</A>96(2476)-96(2495):METHOD_INVOCATION:message.setCode(100)
<A NAME="token108">108:</A>97(2504)-97(2536):IF:if (!gameBoard.isMoveValid(move))
<A NAME="token109">109:</A>97(2509)-97(2535):METHOD_INVOCATION:gameBoard.isMoveValid(move)
<A NAME="token110">110:</A>97(2538)-97(2538):BLOCK:{
<A NAME="token111">111:</A>98(2548)-98(2582):METHOD_INVOCATION:message.setMessage("Invalid move!")
<A NAME="token112">112:</A>99(2591)-99(2591):BLOCK_END:}
<A NAME="token113">113:</A>99(2591)-99(2591):IF_END:}
<A NAME="token114">114:</A>99(2593)-99(2596):ELSE:else
<A NAME="token115">115:</A>99(2598)-99(2598):BLOCK:{
<A NAME="token116">116:</A>100(2608)-100(2635):IF:if (gameBoard.setMove(move))
<A NAME="token117">117:</A>100(2612)-100(2634):METHOD_INVOCATION:gameBoard.setMove(move)
<A NAME="token118">118:</A>100(2637)-100(2637):BLOCK:{
<A NAME="token119">119:</A>101(2649)-101(2671):IF:if (gameBoard.isDraw())
<A NAME="token120">120:</A>101(2653)-101(2670):METHOD_INVOCATION:gameBoard.isDraw()
<A NAME="token121">121:</A>101(2673)-101(2673):BLOCK:{
<A NAME="token122">122:</A>102(2687)-102(2727):METHOD_INVOCATION:message.setMessage("The game is a draw!")
<A NAME="token123">123:</A>103(2740)-103(2740):BLOCK_END:}
<A NAME="token124">124:</A>103(2740)-103(2740):IF_END:}
<A NAME="token125">125:</A>103(2742)-103(2745):ELSE:else
<A NAME="token126">126:</A>103(2747)-103(2747):BLOCK:{
<A NAME="token127">127:</A>104(2765)-104(2794):VARIABLE_DECLARATION:winner = gameBoard.getWinner()
<A NAME="token128">128:</A>104(2774)-104(2794):METHOD_INVOCATION:gameBoard.getWinner()
<A NAME="token129">129:</A>105(2809)-105(2867):METHOD_INVOCATION:message.setMessage(String.format("Player %d won!", winner))
<A NAME="token130">130:</A>105(2828)-105(2866):METHOD_INVOCATION:String.format("Player %d won!", winner)
<A NAME="token131">131:</A>106(2880)-106(2880):BLOCK_END:}
<A NAME="token132">132:</A>106(2880)-106(2880):ELSE_END:}
<A NAME="token133">133:</A>107(2890)-107(2890):BLOCK_END:}
<A NAME="token134">134:</A>107(2890)-107(2890):IF_END:}
<A NAME="token135">135:</A>107(2892)-107(2895):ELSE:else
<A NAME="token136">136:</A>107(2897)-107(2897):BLOCK:{
<A NAME="token137">137:</A>108(2909)-108(2930):METHOD_INVOCATION:message.setMessage("")
<A NAME="token138">138:</A>109(2941)-109(2941):BLOCK_END:}
<A NAME="token139">139:</A>109(2941)-109(2941):ELSE_END:}
<A NAME="token140">140:</A>110(2949)-110(2949):BLOCK_END:}
<A NAME="token141">141:</A>110(2949)-110(2949):ELSE_END:}
<A NAME="token142">142:</A>112(2969)-112(2985):VARIABLE_DECLARATION:gson = new Gson()
<A NAME="token143">143:</A>112(2976)-112(2985):NEW:new Gson()
<A NAME="token144">144:</A>113(2994)-113(3025):METHOD_INVOCATION:ctx.result(gson.toJson(message))
<A NAME="token145">145:</A>113(3005)-113(3024):METHOD_INVOCATION:gson.toJson(message)
<A NAME="token146">146:</A>114(3034)-114(3082):METHOD_INVOCATION:sendGameBoardToAllPlayers(gson.toJson(gameBoard))
<A NAME="token147">147:</A>114(3060)-114(3081):METHOD_INVOCATION:gson.toJson(gameBoard)
<A NAME="token148">148:</A>115(3089)-115(3089):BLOCK_END:}
<A NAME="token149">149:</A>115(3089)-115(3089):IF_END:}
<A NAME="token150">150:</A>118(3141)-118(3179):METHOD_INVOCATION:app.ws("/gameboard", new UiWebSocket())
<A NAME="token151">151:</A>118(3162)-118(3178):NEW:new UiWebSocket()
<A NAME="token152">152:</A>119(3184)-119(3184):METHOD_DECLARATION_END:}
<A NAME="token153">153:</A>125(3352)-125(3406):METHOD_DECLARATION:sendGameBoardToAllPlayers(final String gameBoardJson) {
<A NAME="token154">154:</A>126(3427)-126(3462):VARIABLE_DECLARATION:sessions = UiWebSocket.getSessions()
<A NAME="token155">155:</A>126(3438)-126(3462):METHOD_INVOCATION:UiWebSocket.getSessions()
<A NAME="token156">156:</A>127(3469)-127(3506):FOR:for (Session sessionPlayer : sessions)
<A NAME="token157">157:</A>127(3508)-127(3508):BLOCK:{
<A NAME="token158">158:</A>128(3516)-128(3520):TRY:try {
<A NAME="token159">159:</A>129(3530)-129(3554):METHOD_INVOCATION:sessionPlayer.getRemote()
<A NAME="token160">160:</A>129(3530)-129(3580):METHOD_INVOCATION:sessionPlayer.getRemote().sendString(gameBoardJson)
<A NAME="token161">161:</A>130(3589)-130(3589):TRY_END:}
<A NAME="token162">162:</A>130(3591)-130(3613):CATCH:catch (IOException e) {
<A NAME="token163">163:</A>131(3623)-131(3663):METHOD_INVOCATION:logger.error("An IO exception occurred!")
<A NAME="token164">164:</A>132(3672)-132(3672):CATCH_END:}
<A NAME="token165">165:</A>133(3678)-133(3678):BLOCK_END:}
<A NAME="token166">166:</A>133(3678)-133(3678):FOR_END:}
<A NAME="token167">167:</A>134(3682)-134(3682):METHOD_DECLARATION_END:}
<A NAME="token168">168:</A>136(3706)-136(3713):METHOD_DECLARATION:stop() {
<A NAME="token169">169:</A>137(3719)-137(3728):METHOD_INVOCATION:app.stop()
<A NAME="token170">170:</A>138(3733)-138(3733):METHOD_DECLARATION_END:}
<A NAME="token171">171:</A>139(3735)-139(3735):CLASS_DECLARATION_END:}
</PRE></CODE>
</BODY>
</HTML>
